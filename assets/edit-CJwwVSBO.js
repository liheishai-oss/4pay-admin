import{d as H,g as m,i as C,w as t,C as L,Y as Q,Z as W,$ as ee,D as y,a0 as le,o as k,e as o,a as l,a1 as ae,x as te,E as se,b as oe,y as ne,a2 as re,z as de,X as ie,a3 as ue,k as ce,u as U,a4 as pe,F as me,c as fe,j as A,t as G,a5 as _e,v as ve,q as ge,n as _,a6 as ye,a7 as ke,_ as we}from"./index-BvjDfs_Q.js";/* empty css                    *//* empty css                 *//* empty css             *//* empty css              *//* empty css                     *//* empty css               */const be={class:"dialog-content"},Ve={class:"card-header"},he={class:"card-header"},Ee={class:"permission-actions"},xe={class:"permission-tree-container"},Ce={key:0,class:"debug-info"},Ue={class:"dialog-footer"},Ae=H({__name:"edit",emits:["refresh"],setup(Ge,{expose:K,emit:D}){const v=m(!1),d=m(),R=m(),g=m(!1),I={name:[{required:!0,message:"请输入分组名称",trigger:"blur"}],parent_id:[{required:!1}]},s=m({id:0,parent_id:"",name:"",weight:0,remark:"",is_enabled:0}),c=m([]),N=async()=>{try{console.log("获取权限数据，分组ID:",s.value.id);const a=await W(s.value.id);console.log("权限API完整响应:",a);let e=a.data||a;console.log("处理后的数据:",e),e.tree_data?c.value=e.tree_data:Array.isArray(e)?c.value=e:c.value=[],console.log("权限树数据:",c.value);const n=e.owned_rules||[];n.length>0&&(console.log("已拥有的权限:",n),ee(()=>{d.value&&d.value.setCheckedKeys(n)}))}catch(a){console.error("获取用户权限失败:",a),y.error("获取权限数据失败: "+((a==null?void 0:a.message)||"未知错误"))}},w=m([]),z=async()=>{try{const{data:a}=await Q(s.value.id);w.value=a||[]}catch(a){console.error("获取用户权限失败:",a)}},B=async a=>{try{const{data:e}=await le(a);return e}catch(e){console.error("获取用户权限失败:",e)}},b={label:"title",children:"children"},S=D,F=()=>{if(d.value){const a=V(c.value);d.value.setExpandedKeys(a)}},T=()=>{d.value&&d.value.setExpandedKeys([])},j=()=>{if(d.value){const a=V(c.value);d.value.setCheckedKeys(a)}},q=()=>{d.value&&d.value.setCheckedKeys([])},V=a=>{const e=[],n=p=>{p.forEach(r=>{e.push(r.id),r.children&&r.children.length>0&&n(r.children)})};return n(a),e},O=async(a={})=>{console.log("接收参数",a);const e={...a};if(e.parent_id===0&&(e.parent_id=""),Object.assign(s.value,e),await z(),await N(),e.id>0){const n=await B(e.id);console.log("详情",n),Object.assign(s.value,n)}else s.value.id=0;console.log(s.value),v.value=!0},P=async()=>{var a,e,n;if(!g.value){g.value=!0;try{const p=((a=d.value)==null?void 0:a.getCheckedKeys())||[],r={...s.value,rule_ids:p};let u;r.id==0?u=await ye(r):u=await ke(r),(((e=u.data)==null?void 0:e.code)===200||u.status)&&(y.success(((n=u.data)==null?void 0:n.msg)||u.message||"操作成功"),S("refresh"),v.value=!1)}catch(p){console.error("提交失败:",p),y.error("操作失败，请重试")}finally{g.value=!1}}};return K({open:O}),(a,e)=>{const n=ce,p=re,r=ne,u=oe,h=de,E=se,$=ie,J=ue,M=te,x=ae,f=ge,X=me,Y=_e,Z=L;return k(),C(Z,{modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=i=>v.value=i),title:s.value.id>0?"编辑用户分组":"新增用户分组",width:"60%","close-on-click-modal":!1,class:"group-edit-dialog"},{footer:t(()=>[o("div",Ue,[l(f,{onClick:e[5]||(e[5]=i=>v.value=!1)},{default:t(()=>[...e[16]||(e[16]=[_("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:P,loading:g.value},{default:t(()=>[_(G(s.value.id>0?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:t(()=>[o("div",be,[l(x,{class:"form-card",shadow:"never"},{header:t(()=>[o("div",Ve,[l(n,null,{default:t(()=>[l(U(pe))]),_:1}),e[7]||(e[7]=o("span",null,"基本信息",-1))])]),default:t(()=>[l(M,{model:s.value,"label-width":"100px",rules:I,ref_key:"formRef",ref:R},{default:t(()=>[l(E,{gutter:20},{default:t(()=>[l(u,{span:12},{default:t(()=>[l(r,{label:"上级分组",prop:"parent_id"},{default:t(()=>[l(p,{modelValue:s.value.parent_id,"onUpdate:modelValue":e[0]||(e[0]=i=>s.value.parent_id=i),data:w.value,props:b,"node-key":"id","check-strictly":"",placeholder:"请选择上级分组",clearable:"",filterable:!0,class:"w-full"},null,8,["modelValue","data"])]),_:1})]),_:1}),l(u,{span:12},{default:t(()=>[l(r,{label:"分组名称",prop:"name"},{default:t(()=>[l(h,{modelValue:s.value.name,"onUpdate:modelValue":e[1]||(e[1]=i=>s.value.name=i),placeholder:"请输入分组名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(E,{gutter:20},{default:t(()=>[l(u,{span:12},{default:t(()=>[l(r,{label:"状态",prop:"is_enabled"},{default:t(()=>[l($,{modelValue:s.value.is_enabled,"onUpdate:modelValue":e[2]||(e[2]=i=>s.value.is_enabled=i),"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{span:12},{default:t(()=>[l(r,{label:"权重",prop:"weight"},{default:t(()=>[l(J,{modelValue:s.value.weight,"onUpdate:modelValue":e[3]||(e[3]=i=>s.value.weight=i),min:0,max:999,class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(r,{label:"备注",prop:"remark"},{default:t(()=>[l(h,{modelValue:s.value.remark,"onUpdate:modelValue":e[4]||(e[4]=i=>s.value.remark=i),type:"textarea",rows:3,placeholder:"请输入备注信息",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),l(x,{class:"permission-card",shadow:"never"},{header:t(()=>[o("div",he,[l(n,null,{default:t(()=>[l(U(ve))]),_:1}),e[12]||(e[12]=o("span",null,"权限分配",-1)),o("div",Ee,[l(f,{size:"small",onClick:F},{default:t(()=>[...e[8]||(e[8]=[_("展开全部",-1)])]),_:1}),l(f,{size:"small",onClick:T},{default:t(()=>[...e[9]||(e[9]=[_("收起全部",-1)])]),_:1}),l(f,{size:"small",onClick:j},{default:t(()=>[...e[10]||(e[10]=[_("全选",-1)])]),_:1}),l(f,{size:"small",onClick:q},{default:t(()=>[...e[11]||(e[11]=[_("取消全选",-1)])]),_:1})])])]),default:t(()=>[l(X,{title:"权限分配说明",type:"info",closable:!1,"show-icon":"",class:"permission-tip"},{default:t(()=>[...e[13]||(e[13]=[o("div",{class:"tip-content"},[o("p",null,"• 超级管理员可以分配所有权限"),o("p",null,"• 普通管理组只能分配其父级拥有的权限"),o("p",null,"• 已选中的权限表示该分组当前拥有的权限"),o("p",null,"• 取消选中权限将从该分组中移除该权限")],-1)])]),_:1}),o("div",xe,[c.value.length===0?(k(),fe("div",Ce,[e[14]||(e[14]=o("p",null,"权限数据为空，请检查：",-1)),e[15]||(e[15]=o("ul",null,[o("li",null,"1. 数据库中是否有权限数据"),o("li",null,"2. 权限数据是否启用（status=1）"),o("li",null,"3. 是否有顶级权限（parent_id=0）")],-1)),o("p",null,"当前数据："+G(JSON.stringify(c.value)),1)])):A("",!0),c.value.length>0?(k(),C(Y,{key:1,data:c.value,"show-checkbox":"",ref_key:"treeRef",ref:d,"node-key":"id","expand-on-click-node":!1,props:b,class:"permission-tree","default-expand-all":!1},null,8,["data"])):A("",!0)])]),_:1})])]),_:1},8,["modelValue","title"])}}}),Se=we(Ae,[["__scopeId","data-v-335e6942"]]);export{Se as default};
//# sourceMappingURL=edit-CJwwVSBO.js.map
