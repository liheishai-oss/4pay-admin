const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/detail-CpnB2Kn8.js","assets/index-Dwi2X-zo.js","assets/index-0hRBKvrI.css","assets/orderManagement-JmCzNA4j.js","assets/detail-CoVh6DoR.css","assets/loading-oV0W9nDj.css","assets/empty-iVBaPuAw.css","assets/table-column-DHEyVPoW.css","assets/checkbox-CXazyT-T.css"])))=>i.map(i=>d[i]);
import{d as Ae,g as V,L as Ne,c as z,a,e as r,u as l,w as o,T as Ue,Q as D,j as x,i as f,n as i,t as y,M as re,s as T,D as d,q as He,N as je,O as Ge,P as Qe,aG as Je,o as u,av as We,a1 as Xe,x as Ze,E as Ke,b as Pe,y as et,z as tt,ar as at,as as nt,at as ot,aH as st,k as rt,V as le,S as ie,R as lt,W as it,a8 as dt,aX as ut,aY as ct,aZ as _t,a_ as mt,aw as de,aS as q,$ as pt,_ as gt}from"./index-Dwi2X-zo.js";/* empty css                   *//* empty css               *//* empty css                     *//* empty css                 *//* empty css                          */import{u as ft}from"./table.plugin-CUQXsWP8.js";const ht={class:"table-com-search"},yt={class:"search-buttons"},vt={class:"table-header ba-scroll-style"},bt={class:"table-statistics"},wt={class:"stat-item stat-highlight"},kt={class:"stat-number"},Dt={class:"stat-item stat-highlight"},xt={class:"stat-number"},St={class:"stat-item stat-success"},Tt={class:"stat-number"},Ct={class:"stat-item stat-success"},Mt={class:"stat-number"},Rt={class:"stat-item stat-warning"},Et={class:"stat-number"},Vt={class:"stat-item stat-warning"},qt={class:"stat-number"},$t={class:"stat-item stat-success"},Bt={class:"stat-number"},Ft={class:"table-search"},Yt={style:{width:"100%","overflow-x":"auto"},class:"table-content"},Ot={key:0},zt={key:1},It={class:"table-footer"},Lt={class:"table-pagination"},At=Ae({__name:"home",setup(Nt){const ue=We(()=>de(()=>import("./detail-CpnB2Kn8.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),F=V(null),ce=(e={})=>{console.log(e),pt(()=>{F.value&&F.value.open?F.value.open({...e}):console.error("DetailForm 组件未正确挂载！")})},{handleSelectionChange:_e,hasSelectedRows:Y,selectedRows:U,isVisible:H,toggleVisibility:me,loadData:pe,data:C,refreshData:w,handleSizeChange:ge,handleCurrentChange:fe,searchParams:M}=ft("/api/v1/admin/order");H.value=!0,M.value.search||(M.value.search={});const E=e=>{const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),g=String(e.getHours()).padStart(2,"0"),k=String(e.getMinutes()).padStart(2,"0"),O=String(e.getSeconds()).padStart(2,"0");return`${t}-${n}-${s} ${g}:${k}:${O}`},he=()=>{if(!M.value.search){const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),n=new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59);M.value.search={order_no:"",merchant_order_no:"",merchant_id:"",status:"",start_time:E(t),end_time:E(n)}}},j=()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),n=new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59);return[E(t),E(n)]},p=V({order_no:"",merchant_order_no:"",merchant_id:"",status:"",timeRange:j()}),$=V([]),_=V(null),I=V(!1),v=V(null),L=e=>e?Number(e).toFixed(2):"0.00",ye=e=>e?Number(e).toFixed(2):"0.00",ve=async()=>{try{const e=await T.get("/api/v1/admin/user/info");console.log("用户信息API响应:",e),e.code===200&&(_.value=e.data,console.log("用户信息:",_.value),console.log("是否为商户管理员:",_.value.is_merchant_admin))}catch(e){console.error("获取用户信息失败:",e)}},be=async()=>{try{const e=await T.get("/api/v1/admin/merchant",{params:{page:1,page_size:1e3,search:JSON.stringify({})}});console.log("商户API响应:",e),e.code===200?($.value=e.data.data||[],console.log("商户列表:",$.value)):console.log("商户API响应错误:",e)}catch(e){console.error("获取商户列表失败:",e),$.value=[]}},A=async(e={})=>{var t;try{const n={};e&&Object.keys(e).length>0&&(e.timeRange&&e.timeRange.length===2&&(n.start_time=e.timeRange[0],n.end_time=e.timeRange[1]),e.order_no&&(n.order_no=e.order_no),e.merchant_order_no&&(n.merchant_order_no=e.merchant_order_no),e.merchant_id&&!((t=_.value)!=null&&t.is_merchant_admin)&&(n.merchant_id=e.merchant_id),e.status&&(n.status=e.status),e.start_time&&(n.start_time=e.start_time),e.end_time&&(n.end_time=e.end_time)),console.log("统计接口请求参数:",n);const s=await T.get("/api/v1/admin/order/statistics",{params:n});s.code===200&&(v.value=s.data,console.log("统计数据更新:",v.value))}catch(n){console.error("获取统计数据失败:",n),v.value={total_orders:0,total_amount:0,paid_orders:0,paid_amount:0,merchant_income:0,unpaid_orders:0,unpaid_amount:0,success_rate:0}}},G=async()=>{I.value=!0;try{let e={...p.value};e.timeRange&&e.timeRange.length===2&&(e.start_time=e.timeRange[0],e.end_time=e.timeRange[1]),delete e.timeRange,delete e.quickTime,M.value.search=e,await w(),await A(e)}catch(e){console.error("搜索失败:",e),d.error("搜索失败，请重试")}finally{I.value=!1}},we=async()=>{var s,g;p.value={order_no:"",merchant_order_no:"",merchant_id:((s=_.value)!=null&&s.is_merchant_admin,""),status:"",timeRange:j()};const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),n=new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59);M.value.search={order_no:"",merchant_order_no:"",merchant_id:((g=_.value)!=null&&g.is_merchant_admin,""),status:"",start_time:E(t),end_time:E(n)},await w(),await A(M.value.search)};Ne(async()=>{var e;he(),await pe(),await A(),await ve(),await be(),await G(),console.log("data.admin:",C.value.admin),console.log("userInfo:",_.value),console.log("merchantList:",$.value),console.log("isMerchantAdmin:",(e=_.value)==null?void 0:e.is_merchant_admin)});const Q=e=>({1:"待支付",2:"支付中",3:"支付成功",4:"支付失败",5:"已退款",6:"已关闭"})[e]||"未知状态",ke=e=>({1:"warning",2:"primary",3:"success",4:"danger",5:"info",6:"info"})[e]||"info",De=e=>({0:"未通知",1:"通知成功",2:"通知失败"})[e]||"未知状态",xe=e=>({0:"warning",1:"success",2:"danger"})[e]||"info",Se=async e=>{try{await q.confirm(`确定要退款订单 ${e.order_no} 吗？`,"确认退款",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const{refundOrder:t}=await de(async()=>{const{refundOrder:s}=await import("./orderManagement-JmCzNA4j.js");return{refundOrder:s}},__vite__mapDeps([3,1,2])),n=await t("/api/v1/admin/order/refund",{order_id:e.id,reason:"管理员退款"});n.status?(d.success("退款申请已提交"),w()):d.error(n.message)}catch(t){t!=="cancel"&&d.error("退款申请失败")}},Te=async e=>{try{await q.confirm(`确定要补单 ${e.order_no} 吗？`,"确认补单",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=await T.post("/api/v1/admin/order/reissue",{ids:[e.id]});t.code===200?(d.success("补单成功"),w()):d.error(t.msg)}catch{d.error("补单失败")}},Ce=async e=>{try{await q.confirm(`确定要重新回调 ${e.order_no} 吗？`,"确认回调",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=await T.post("/api/v1/admin/order/callback",{ids:[e.id]});t.code===200?(d.success("回调成功"),w()):d.error(t.msg)}catch{d.error("回调失败")}},Me=async()=>{var e;if(!Y.value){d.warning("请选择要补单的订单");return}try{await q.confirm("确定要批量补单选中的订单吗？","确认批量补单",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=await T.post("/api/v1/admin/order/reissue",{ids:((e=U.value)==null?void 0:e.map(n=>n.id))||[]});t.code===200?(d.success("批量补单成功"),w()):d.error(t.msg)}catch{d.error("批量补单失败")}},Re=async()=>{var e;if(!Y.value){d.warning("请选择要回调的订单");return}try{await q.confirm("确定要批量回调选中的订单吗？","确认批量回调",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=await T.post("/api/v1/admin/order/callback",{ids:((e=U.value)==null?void 0:e.map(n=>n.id))||[]});t.code===200?(d.success("批量回调成功"),w()):d.error(t.msg)}catch{d.error("批量回调失败")}},Ee=(e,t)=>{switch(e){case"detail":ce(t);break;case"query":Ve(t);break;case"refund":Se(t);break;case"resend":Te(t);break;case"callback":Ce(t);break;default:console.warn("未知操作:",e)}},Ve=async e=>{try{const t=await T.post("/api/v1/admin/order/query",{order_no:e.order_no});if(t.code===200){const n=t.data;let s=`📋 订单信息
`;s+=`═══════════════════════════════════════════════════════════
`,s+=`🔢 订单号：${n.order_no}
`,s+=`📊 当前状态：${Q(n.status)}
`,s+=`💰 订单金额：¥${(n.amount/100).toFixed(2)}
`,s+=`📅 创建时间：${new Date(n.created_at).toLocaleString()}

`,s+=`🔍 支付通道查询结果
`,s+=`───────────────────────────────────────────────────────────
`,n.query_success?(s+=`✅ 查询状态：成功
`,n.query_result&&n.query_result.unified_status_text?s+=`📊 当前状态：${n.query_result.unified_status_text}
`:s+=`📊 当前状态：${n.query_message}
`,n.query_result&&n.query_result.unified_status_text&&(s+=`
📋 状态详情：
`,s+=`───────────────────────────────────────────────────────────
`,s+=`🎯 统一状态：${n.query_result.unified_status_text}
`,s+=`📝 原始状态：${n.query_result.original_status||"未知"}
`,s+=`📊 状态字段：${n.query_result.original_status_field||"status"}
`,s+=`🏢 供货商类型：${n.query_result.supplier_type||"未知"}
`),n.query_result&&Object.keys(n.query_result).length>0||(s+=`
📄 通道返回数据：无数据
`)):(s+=`❌ 查询状态：失败
`,s+=`⚠️  错误信息：${n.query_message}
`),s+=`
═══════════════════════════════════════════════════════════`;const g=s.replace(/\n/g,"<br>").replace(/`([^`]+)`/g,"<code>$1</code>");q.alert(g,"🔍 查单结果",{confirmButtonText:"确定",type:n.query_success?"success":"warning",dangerouslyUseHTMLString:!0,customStyle:{"max-width":"900px","max-height":"700px",overflow:"auto","font-family":"monospace","line-height":"1.6","white-space":"pre-wrap","word-break":"break-all"}})}else console.error("查单API返回错误：",t),d.error(t.msg||"查单失败")}catch(t){console.error("查单请求异常：",t),d.error("查单失败："+(t.message||"网络错误"))}};return(e,t)=>{var X,Z,K,P,ee,te,ae,ne,oe;const n=tt,s=et,g=Pe,k=ot,O=at,J=Ke,qe=st,N=rt,R=He,$e=Ze,Be=Xe,Fe=je,b=it,W=dt,B=mt,Ye=_t,Oe=ut,ze=Ge,Ie=Qe,S=Je("permission");return u(),z(re,null,[a(l(ue),{ref_key:"detailFormRef",ref:F,onRefresh:l(w)},null,8,["onRefresh"]),a(Ue,{name:"fade"},{default:o(()=>[D(r("div",ht,[a(Be,{class:"search-card",shadow:"never"},{default:o(()=>[a($e,{model:p.value,"label-width":"100px",class:"search-form"},{default:o(()=>[a(J,{gutter:20},{default:o(()=>{var h;return[a(g,{span:6},{default:o(()=>[a(s,{label:"订单号"},{default:o(()=>[a(n,{modelValue:p.value.order_no,"onUpdate:modelValue":t[0]||(t[0]=m=>p.value.order_no=m),placeholder:"请输入订单号",clearable:"","prefix-icon":"Search"},null,8,["modelValue"])]),_:1})]),_:1}),a(g,{span:6},{default:o(()=>[a(s,{label:"商户订单号"},{default:o(()=>[a(n,{modelValue:p.value.merchant_order_no,"onUpdate:modelValue":t[1]||(t[1]=m=>p.value.merchant_order_no=m),placeholder:"请输入商户订单号",clearable:"","prefix-icon":"Search"},null,8,["modelValue"])]),_:1})]),_:1}),(h=_.value)!=null&&h.is_merchant_admin?x("",!0):(u(),f(g,{key:0,span:6},{default:o(()=>[a(s,{label:"商户"},{default:o(()=>[a(O,{modelValue:p.value.merchant_id,"onUpdate:modelValue":t[2]||(t[2]=m=>p.value.merchant_id=m),placeholder:"请选择商户",clearable:"",filterable:"",style:{width:"100%"}},{default:o(()=>[(u(!0),z(re,null,nt($.value,m=>(u(),f(k,{key:m.id,label:m.merchant_name,value:m.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})),a(g,{span:6},{default:o(()=>[a(s,{label:"订单状态"},{default:o(()=>[a(O,{modelValue:p.value.status,"onUpdate:modelValue":t[3]||(t[3]=m=>p.value.status=m),placeholder:"请选择订单状态",clearable:"",style:{width:"100%"}},{default:o(()=>[a(k,{label:"待支付",value:1}),a(k,{label:"支付中",value:2}),a(k,{label:"支付成功",value:3}),a(k,{label:"支付失败",value:4}),a(k,{label:"已退款",value:5}),a(k,{label:"已关闭",value:6})]),_:1},8,["modelValue"])]),_:1})]),_:1})]}),_:1}),a(J,{gutter:20},{default:o(()=>[a(g,{span:6},{default:o(()=>[a(s,{label:"时间范围"},{default:o(()=>[a(qe,{modelValue:p.value.timeRange,"onUpdate:modelValue":t[4]||(t[4]=h=>p.value.timeRange=h),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(g,{span:6},{default:o(()=>[a(s,null,{default:o(()=>[r("div",yt,[a(R,{type:"primary",onClick:G,loading:I.value},{default:o(()=>[a(N,null,{default:o(()=>[a(l(le))]),_:1}),t[7]||(t[7]=i(" 搜索 ",-1))]),_:1},8,["loading"]),a(R,{onClick:we},{default:o(()=>[a(N,null,{default:o(()=>[a(l(ie))]),_:1}),t[8]||(t[8]=i(" 重置 ",-1))]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[lt,l(H)]])]),_:1}),r("div",vt,[D(a(R,{icon:l(ie),onClick:l(w),color:"#40485b"},null,8,["icon","onClick"]),[[S,"order:list"]]),(X=_.value)!=null&&X.is_merchant_admin?x("",!0):D((u(),f(R,{key:0,type:"primary",disabled:!l(Y),onClick:Me},{default:o(()=>[...t[9]||(t[9]=[i("补单",-1)])]),_:1},8,["disabled"])),[[S,"order:resend"]]),(Z=_.value)!=null&&Z.is_merchant_admin?x("",!0):D((u(),f(R,{key:1,type:"primary",disabled:!l(Y),onClick:Re},{default:o(()=>[...t[10]||(t[10]=[i("回调",-1)])]),_:1},8,["disabled"])),[[S,"order:callback"]]),r("div",bt,[r("span",wt,[t[11]||(t[11]=i("累计订单数: ",-1)),r("b",kt,y(((K=v.value)==null?void 0:K.total_orders)||0),1)]),r("span",Dt,[t[12]||(t[12]=i("订单总金额: ",-1)),r("b",xt,"¥"+y(L(((P=v.value)==null?void 0:P.total_amount)||0)),1)]),r("span",St,[t[13]||(t[13]=i("已付订单数: ",-1)),r("b",Tt,y(((ee=v.value)==null?void 0:ee.paid_orders)||0),1)]),r("span",Ct,[t[14]||(t[14]=i("已付总金额: ",-1)),r("b",Mt,"¥"+y(L(((te=v.value)==null?void 0:te.paid_amount)||0)),1)]),r("span",Rt,[t[15]||(t[15]=i("未付订单数: ",-1)),r("b",Et,y(((ae=v.value)==null?void 0:ae.unpaid_orders)||0),1)]),r("span",Vt,[t[16]||(t[16]=i("未付总金额: ",-1)),r("b",qt,"¥"+y(L(((ne=v.value)==null?void 0:ne.unpaid_amount)||0)),1)]),r("span",$t,[t[17]||(t[17]=i("成功率: ",-1)),r("b",Bt,y(ye(((oe=v.value)==null?void 0:oe.success_rate)||0))+"%",1)])]),r("div",Ft,[a(Fe,{class:"ml-4"},{default:o(()=>[a(R,{icon:l(le),onClick:l(me)},null,8,["icon","onClick"])]),_:1})])]),r("div",Yt,[a(ze,{data:l(C).data,border:"",stripe:"","max-height":"600",style:{width:"100%"},onSelectionChange:l(_e)},{default:o(()=>{var h,m,se;return[a(b,{type:"selection",width:"40"}),a(b,{prop:"order_no",label:"平台单号",align:"center","min-width":"200"}),a(b,{prop:"merchant_order_no",label:"商户单号",align:"center","min-width":"167"}),a(b,{prop:"amount",label:"订单金额",align:"center","min-width":"100"},{default:o(({row:c})=>[i(" ¥"+y((c.amount/100).toFixed(2)),1)]),_:1}),a(b,{label:"支付状态",align:"center","min-width":"100"},{default:o(({row:c})=>[a(W,{type:ke(c.status)},{default:o(()=>[i(y(Q(c.status)),1)]),_:2},1032,["type"])]),_:1}),a(b,{prop:"notify_status",label:"回调状态",align:"center","min-width":"100"},{default:o(({row:c})=>[a(W,{type:xe(c.notify_status),size:"small"},{default:o(()=>[i(y(De(c.notify_status)),1)]),_:2},1032,["type"])]),_:1}),(h=_.value)!=null&&h.is_merchant_admin?x("",!0):(u(),f(b,{key:0,prop:"merchant.merchant_name",label:"商户名称",align:"center","min-width":"150"})),(m=_.value)!=null&&m.is_merchant_admin?x("",!0):(u(),f(b,{key:1,label:"通道名称",align:"center","min-width":"120"},{default:o(({row:c})=>[c.channel?(u(),z("span",Ot,y(c.channel.channel_name||"百亿支付"),1)):(u(),z("span",zt," 百亿支付 "))]),_:1})),a(b,{prop:"paid_time",label:"支付时间",align:"center","min-width":"160"}),(se=_.value)!=null&&se.is_merchant_admin?x("",!0):(u(),f(b,{key:2,label:"操作",align:"center",fixed:"right","min-width":"120"},{default:o(c=>[a(Oe,{trigger:"click",onCommand:Le=>Ee(Le,c.row)},{dropdown:o(()=>[a(Ye,null,{default:o(()=>[D((u(),f(B,{command:"detail"},{default:o(()=>[...t[19]||(t[19]=[i("订单详情",-1)])]),_:1})),[[S,"order:detail"]]),D((u(),f(B,{command:"query"},{default:o(()=>[...t[20]||(t[20]=[i("查单",-1)])]),_:1})),[[S,"order:query"]]),c.row.status===3?D((u(),f(B,{key:0,command:"refund"},{default:o(()=>[...t[21]||(t[21]=[i("退款",-1)])]),_:1})),[[S,"order:refund"]]):x("",!0),[4,6].includes(c.row.status)?D((u(),f(B,{key:1,command:"resend"},{default:o(()=>[...t[22]||(t[22]=[i("补单",-1)])]),_:1})),[[S,"order:resend"]]):x("",!0),c.row.status===3?D((u(),f(B,{key:2,command:"callback"},{default:o(()=>[...t[23]||(t[23]=[i("回调",-1)])]),_:1})),[[S,"order:callback"]]):x("",!0)]),_:2},1024)]),default:o(()=>[a(R,{size:"small",type:"primary"},{default:o(()=>[t[18]||(t[18]=i(" 操作",-1)),a(N,{class:"el-icon--right"},{default:o(()=>[a(l(ct))]),_:1})]),_:1})]),_:2},1032,["onCommand"])]),_:1}))]}),_:1},8,["data","onSelectionChange"])]),r("div",It,[r("div",Lt,[a(Ie,{"current-page":l(C).current_page,"onUpdate:currentPage":t[5]||(t[5]=h=>l(C).current_page=h),"page-size":l(C).page_size,"onUpdate:pageSize":t[6]||(t[6]=h=>l(C).page_size=h),"page-sizes":[10,50,100,200],background:!0,"prev-text":"上一页","next-text":"下一页",layout:"total, sizes, prev, pager, next, jumper",total:l(C).page_total,onSizeChange:l(ge),onCurrentChange:l(fe)},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])],64)}}}),Xt=gt(At,[["__scopeId","data-v-c30a1d00"]]);export{Xt as default};
//# sourceMappingURL=home-Bov4PqSS.js.map
