const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/detail-BOMMj6Ji.js","assets/index-BwnaPa-Z.js","assets/index-qjTWfGgT.css","assets/orderManagement-Bkf5nT_y.js","assets/detail-CoVh6DoR.css","assets/loading-oV0W9nDj.css","assets/empty-iVBaPuAw.css","assets/table-column-DHEyVPoW.css","assets/checkbox-CXazyT-T.css"])))=>i.map(i=>d[i]);
import{d as Fe,g as R,L as Oe,c as q,a,e as r,u as i,w as n,T as Ie,Q as h,i as v,n as d,t as m,M as P,s as k,q as $e,N as ze,O as Ye,P as Ae,aG as Le,o as c,av as Ne,a1 as Ue,x as He,E as je,b as Ge,y as Qe,z as Je,ar as We,as as Xe,at as Ze,aH as Ke,k as Pe,V as ee,S as te,R as et,W as tt,a8 as at,aX as nt,aY as ot,aZ as st,j as Y,a_ as lt,aw as ae,D as u,aS as E,$ as rt,_ as it}from"./index-BwnaPa-Z.js";/* empty css                   *//* empty css               *//* empty css                     *//* empty css                 *//* empty css                          */import{u as dt}from"./table.plugin-Ba7UP9qi.js";const ut={class:"table-com-search"},ct={key:1,style:{color:"#999","font-size":"12px"}},_t={class:"search-buttons"},mt={class:"table-header ba-scroll-style"},pt={class:"table-statistics"},gt={class:"stat-item stat-highlight"},ft={class:"stat-number"},yt={class:"stat-item stat-highlight"},ht={class:"stat-number"},vt={class:"stat-item stat-success"},bt={class:"stat-number"},wt={class:"stat-item stat-success"},kt={class:"stat-number"},xt={class:"stat-item stat-warning"},Dt={class:"stat-number"},St={class:"stat-item stat-warning"},Tt={class:"stat-number"},Ct={class:"stat-item stat-success"},Rt={class:"stat-number"},Et={class:"table-search"},Mt={style:{width:"100%","overflow-x":"auto"},class:"table-content"},Vt={key:0},qt={key:1},Bt={class:"table-footer"},Ft={class:"table-pagination"},Ot=Fe({__name:"home",setup(It){const ne=Ne(()=>ae(()=>import("./detail-BOMMj6Ji.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),B=R(null),oe=(e={})=>{console.log(e),rt(()=>{B.value&&B.value.open?B.value.open({...e}):console.error("DetailForm 组件未正确挂载！")})},{handleSelectionChange:se,hasSelectedRows:F,isVisible:A,toggleVisibility:le,loadData:re,data:f,refreshData:y,handleSizeChange:ie,handleCurrentChange:de,searchParams:x}=dt("/api/v1/admin/order");A.value=!0,x.value.search||(x.value.search={});const ue=()=>{if(!x.value.search){const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),o=new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59);x.value.search={order_no:"",merchant_order_no:"",merchant_id:"",status:"",start_time:t.toISOString().slice(0,19).replace("T"," "),end_time:o.toISOString().slice(0,19).replace("T"," ")}}},L=()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),o=new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59);return[t,o]},_=R({order_no:"",merchant_order_no:"",merchant_id:"",status:"",timeRange:L()}),M=R([]),C=R(null),O=R(!1),p=R(null),I=e=>e?Number(e).toFixed(2):"0.00",ce=e=>e?Number(e).toFixed(2):"0.00",_e=async()=>{try{const e=await k.get("/api/v1/admin/user/info");console.log("用户信息API响应:",e),e.code===200&&(C.value=e.data,console.log("用户信息:",C.value),console.log("是否为商户管理员:",C.value.is_merchant_admin))}catch(e){console.error("获取用户信息失败:",e)}},me=async()=>{try{const e=await k.get("/api/v1/admin/merchant",{params:{page:1,page_size:1e3,search:JSON.stringify({})}});console.log("商户API响应:",e),e.code===200?(M.value=e.data.data||[],console.log("商户列表:",M.value)):console.log("商户API响应错误:",e)}catch(e){console.error("获取商户列表失败:",e),M.value=[]}},$=async(e={})=>{try{const t={};e&&Object.keys(e).length>0&&(e.timeRange&&e.timeRange.length===2&&(t.start_time=e.timeRange[0],t.end_time=e.timeRange[1]),e.order_no&&(t.order_no=e.order_no),e.merchant_order_no&&(t.merchant_order_no=e.merchant_order_no),e.merchant_id&&(t.merchant_id=e.merchant_id),e.status&&(t.status=e.status),e.start_time&&(t.start_time=e.start_time),e.end_time&&(t.end_time=e.end_time)),console.log("统计接口请求参数:",t);const o=await k.get("/api/v1/admin/order/statistics",{params:t});o.code===200&&(p.value=o.data,console.log("统计数据更新:",p.value))}catch(t){console.error("获取统计数据失败:",t),p.value={total_orders:0,total_amount:0,paid_orders:0,paid_amount:0,merchant_income:0,unpaid_orders:0,unpaid_amount:0,success_rate:0}}},pe=async()=>{O.value=!0;try{let e={..._.value};e.timeRange&&e.timeRange.length===2&&(e.start_time=e.timeRange[0],e.end_time=e.timeRange[1]),delete e.timeRange,delete e.quickTime,x.value.search=e,await y(),await $(e)}catch(e){console.error("搜索失败:",e),u.error("搜索失败，请重试")}finally{O.value=!1}},ge=async()=>{_.value={order_no:"",merchant_order_no:"",merchant_id:"",status:"",timeRange:L()};const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),o=new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59);x.value.search={order_no:"",merchant_order_no:"",merchant_id:"",status:"",start_time:t.toISOString().slice(0,19).replace("T"," "),end_time:o.toISOString().slice(0,19).replace("T"," ")},await y(),await $(x.value.search)};Oe(()=>{var e;ue(),re(),$(),_e(),me(),console.log("data.admin:",f.value.admin),console.log("userInfo:",C.value),console.log("merchantList:",M.value),console.log("isMerchantAdmin:",(e=C.value)==null?void 0:e.is_merchant_admin)});const N=e=>({1:"待支付",2:"支付中",3:"支付成功",4:"支付失败",5:"已退款",6:"已关闭"})[e]||"未知状态",fe=e=>({1:"warning",2:"primary",3:"success",4:"danger",5:"info",6:"info"})[e]||"info",ye=e=>({0:"未通知",1:"通知成功",2:"通知失败"})[e]||"未知状态",he=e=>({0:"warning",1:"success",2:"danger"})[e]||"info",ve=async e=>{try{await E.confirm(`确定要退款订单 ${e.order_no} 吗？`,"确认退款",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const{refundOrder:t}=await ae(async()=>{const{refundOrder:s}=await import("./orderManagement-Bkf5nT_y.js");return{refundOrder:s}},__vite__mapDeps([3,1,2])),o=await t("/api/v1/admin/order/refund",{order_id:e.id,reason:"管理员退款"});o.status?(u.success("退款申请已提交"),y()):u.error(o.message)}catch(t){t!=="cancel"&&u.error("退款申请失败")}},be=async e=>{try{await E.confirm(`确定要补单 ${e.order_no} 吗？`,"确认补单",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=await k.post("/api/v1/admin/order/reissue",{ids:[e.id]});t.code===200?(u.success("补单成功"),y()):u.error(t.msg)}catch{u.error("补单失败")}},we=async e=>{try{await E.confirm(`确定要重新回调 ${e.order_no} 吗？`,"确认回调",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=await k.post("/api/v1/admin/order/callback",{ids:[e.id]});t.code===200?(u.success("回调成功"),y()):u.error(t.msg)}catch{u.error("回调失败")}},ke=async()=>{var e;if(!F.value){u.warning("请选择要补单的订单");return}try{await E.confirm("确定要批量补单选中的订单吗？","确认批量补单",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=await k.post("/api/v1/admin/order/reissue",{ids:((e=f.value.selectedRows)==null?void 0:e.map(o=>o.id))||[]});t.code===200?(u.success("批量补单成功"),y()):u.error(t.msg)}catch{u.error("批量补单失败")}},xe=async()=>{var e;if(!F.value){u.warning("请选择要回调的订单");return}try{await E.confirm("确定要批量回调选中的订单吗？","确认批量回调",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=await k.post("/api/v1/admin/order/callback",{ids:((e=f.value.selectedRows)==null?void 0:e.map(o=>o.id))||[]});t.code===200?(u.success("批量回调成功"),y()):u.error(t.msg)}catch{u.error("批量回调失败")}},De=(e,t)=>{switch(e){case"detail":oe(t);break;case"query":Se(t);break;case"refund":ve(t);break;case"resend":be(t);break;case"callback":we(t);break;default:console.warn("未知操作:",e)}},Se=async e=>{try{const t=await k.post("/api/v1/admin/order/query",{order_no:e.order_no});if(t.code===200){const o=t.data;let s=`📋 订单信息
`;s+=`═══════════════════════════════════════════════════════════
`,s+=`🔢 订单号：${o.order_no}
`,s+=`📊 当前状态：${N(o.status)}
`,s+=`💰 订单金额：¥${(o.amount/100).toFixed(2)}
`,s+=`📅 创建时间：${new Date(o.created_at).toLocaleString()}

`,s+=`🔍 支付通道查询结果
`,s+=`───────────────────────────────────────────────────────────
`,o.query_success?(s+=`✅ 查询状态：成功
`,o.query_result&&o.query_result.unified_status_text?s+=`📊 当前状态：${o.query_result.unified_status_text}
`:s+=`📊 当前状态：${o.query_message}
`,o.query_result&&o.query_result.unified_status_text&&(s+=`
📋 状态详情：
`,s+=`───────────────────────────────────────────────────────────
`,s+=`🎯 统一状态：${o.query_result.unified_status_text}
`,s+=`📝 原始状态：${o.query_result.original_status||"未知"}
`,s+=`📊 状态字段：${o.query_result.original_status_field||"status"}
`,s+=`🏢 供货商类型：${o.query_result.supplier_type||"未知"}
`),o.query_result&&Object.keys(o.query_result).length>0||(s+=`
📄 通道返回数据：无数据
`)):(s+=`❌ 查询状态：失败
`,s+=`⚠️  错误信息：${o.query_message}
`),s+=`
═══════════════════════════════════════════════════════════`;const b=s.replace(/\n/g,"<br>").replace(/`([^`]+)`/g,"<code>$1</code>");E.alert(b,"🔍 查单结果",{confirmButtonText:"确定",type:o.query_success?"success":"warning",dangerouslyUseHTMLString:!0,customStyle:{"max-width":"900px","max-height":"700px",overflow:"auto","font-family":"monospace","line-height":"1.6","white-space":"pre-wrap","word-break":"break-all"}})}else console.error("查单API返回错误：",t),u.error(t.msg||"查单失败")}catch(t){console.error("查单请求异常：",t),u.error("查单失败："+(t.message||"网络错误"))}};return(e,t)=>{var G,Q,J,W,X,Z,K;const o=Je,s=Qe,b=Ge,D=Ze,U=We,H=je,Te=Ke,z=Pe,S=$e,Ce=He,Re=Ue,Ee=ze,g=tt,j=at,V=lt,Me=st,Ve=nt,qe=Ye,Be=Ae,w=Le("permission");return c(),q(P,null,[a(i(ne),{ref_key:"detailFormRef",ref:B,onRefresh:i(y)},null,8,["onRefresh"]),a(Ie,{name:"fade"},{default:n(()=>[h(r("div",ut,[a(Re,{class:"search-card",shadow:"never"},{default:n(()=>[a(Ce,{model:_.value,"label-width":"100px",class:"search-form"},{default:n(()=>[a(H,{gutter:20},{default:n(()=>[a(b,{span:6},{default:n(()=>[a(s,{label:"订单号"},{default:n(()=>[a(o,{modelValue:_.value.order_no,"onUpdate:modelValue":t[0]||(t[0]=l=>_.value.order_no=l),placeholder:"请输入订单号",clearable:"","prefix-icon":"Search"},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{span:6},{default:n(()=>[a(s,{label:"商户订单号"},{default:n(()=>[a(o,{modelValue:_.value.merchant_order_no,"onUpdate:modelValue":t[1]||(t[1]=l=>_.value.merchant_order_no=l),placeholder:"请输入商户订单号",clearable:"","prefix-icon":"Search"},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{span:6},{default:n(()=>[a(s,{label:"商户"},{default:n(()=>{var l;return[(l=C.value)!=null&&l.is_merchant_admin?(c(),q("div",ct," 商户用户无需选择商户 ")):(c(),v(U,{key:0,modelValue:_.value.merchant_id,"onUpdate:modelValue":t[2]||(t[2]=T=>_.value.merchant_id=T),placeholder:"请选择商户",clearable:"",filterable:"",style:{width:"100%"}},{default:n(()=>[(c(!0),q(P,null,Xe(M.value,T=>(c(),v(D,{key:T.id,label:T.merchant_name,value:T.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]}),_:1})]),_:1}),a(b,{span:6},{default:n(()=>[a(s,{label:"订单状态"},{default:n(()=>[a(U,{modelValue:_.value.status,"onUpdate:modelValue":t[3]||(t[3]=l=>_.value.status=l),placeholder:"请选择订单状态",clearable:"",style:{width:"100%"}},{default:n(()=>[a(D,{label:"待支付",value:1}),a(D,{label:"支付中",value:2}),a(D,{label:"支付成功",value:3}),a(D,{label:"支付失败",value:4}),a(D,{label:"已退款",value:5}),a(D,{label:"已关闭",value:6})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(H,{gutter:20},{default:n(()=>[a(b,{span:6},{default:n(()=>[a(s,{label:"时间范围"},{default:n(()=>[a(Te,{modelValue:_.value.timeRange,"onUpdate:modelValue":t[4]||(t[4]=l=>_.value.timeRange=l),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{span:6},{default:n(()=>[a(s,null,{default:n(()=>[r("div",_t,[a(S,{type:"primary",onClick:pe,loading:O.value},{default:n(()=>[a(z,null,{default:n(()=>[a(i(ee))]),_:1}),t[7]||(t[7]=d(" 搜索 ",-1))]),_:1},8,["loading"]),a(S,{onClick:ge},{default:n(()=>[a(z,null,{default:n(()=>[a(i(te))]),_:1}),t[8]||(t[8]=d(" 重置 ",-1))]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[et,i(A)]])]),_:1}),r("div",mt,[h(a(S,{icon:i(te),onClick:i(y),color:"#40485b"},null,8,["icon","onClick"]),[[w,"order:list"]]),h((c(),v(S,{type:"primary",disabled:!i(F),onClick:ke},{default:n(()=>[...t[9]||(t[9]=[d("补单",-1)])]),_:1},8,["disabled"])),[[w,"order:resend"]]),h((c(),v(S,{type:"primary",disabled:!i(F),onClick:xe},{default:n(()=>[...t[10]||(t[10]=[d("回调",-1)])]),_:1},8,["disabled"])),[[w,"order:callback"]]),r("div",pt,[r("span",gt,[t[11]||(t[11]=d("累计订单数: ",-1)),r("b",ft,m(((G=p.value)==null?void 0:G.total_orders)||0),1)]),r("span",yt,[t[12]||(t[12]=d("订单总金额: ",-1)),r("b",ht,"¥"+m(I(((Q=p.value)==null?void 0:Q.total_amount)||0)),1)]),r("span",vt,[t[13]||(t[13]=d("已付订单数: ",-1)),r("b",bt,m(((J=p.value)==null?void 0:J.paid_orders)||0),1)]),r("span",wt,[t[14]||(t[14]=d("已付总金额: ",-1)),r("b",kt,"¥"+m(I(((W=p.value)==null?void 0:W.paid_amount)||0)),1)]),r("span",xt,[t[15]||(t[15]=d("未付订单数: ",-1)),r("b",Dt,m(((X=p.value)==null?void 0:X.unpaid_orders)||0),1)]),r("span",St,[t[16]||(t[16]=d("未付总金额: ",-1)),r("b",Tt,"¥"+m(I(((Z=p.value)==null?void 0:Z.unpaid_amount)||0)),1)]),r("span",Ct,[t[17]||(t[17]=d("成功率: ",-1)),r("b",Rt,m(ce(((K=p.value)==null?void 0:K.success_rate)||0))+"%",1)])]),r("div",Et,[a(Ee,{class:"ml-4"},{default:n(()=>[a(S,{icon:i(ee),onClick:i(le)},null,8,["icon","onClick"])]),_:1})])]),r("div",Mt,[a(qe,{data:i(f).data,border:"",stripe:"","max-height":"600",style:{width:"100%"},onSelectionChange:i(se)},{default:n(()=>[a(g,{type:"selection",width:"40"}),a(g,{prop:"order_no",label:"平台单号",align:"center","min-width":"200"}),a(g,{prop:"merchant_order_no",label:"商户单号",align:"center","min-width":"167"}),a(g,{prop:"amount",label:"订单金额",align:"center","min-width":"100"},{default:n(({row:l})=>[d(" ¥"+m((l.amount/100).toFixed(2)),1)]),_:1}),a(g,{label:"支付状态",align:"center","min-width":"100"},{default:n(({row:l})=>[a(j,{type:fe(l.status)},{default:n(()=>[d(m(N(l.status)),1)]),_:2},1032,["type"])]),_:1}),a(g,{prop:"notify_status",label:"回调状态",align:"center","min-width":"100"},{default:n(({row:l})=>[a(j,{type:he(l.notify_status),size:"small"},{default:n(()=>[d(m(ye(l.notify_status)),1)]),_:2},1032,["type"])]),_:1}),a(g,{prop:"merchant.merchant_name",label:"商户名称",align:"center","min-width":"150"}),a(g,{label:"通道名称",align:"center","min-width":"120"},{default:n(({row:l})=>[l.channel?(c(),q("span",Vt,m(l.channel.channel_name||"百亿支付"),1)):(c(),q("span",qt," 百亿支付 "))]),_:1}),a(g,{prop:"paid_time",label:"支付时间",align:"center","min-width":"160"}),a(g,{label:"操作",align:"center",fixed:"right","min-width":"120"},{default:n(l=>[a(Ve,{trigger:"click",onCommand:T=>De(T,l.row)},{dropdown:n(()=>[a(Me,null,{default:n(()=>[h((c(),v(V,{command:"detail"},{default:n(()=>[...t[19]||(t[19]=[d("订单详情",-1)])]),_:1})),[[w,"order:detail"]]),h((c(),v(V,{command:"query"},{default:n(()=>[...t[20]||(t[20]=[d("查单",-1)])]),_:1})),[[w,"order:query"]]),l.row.status===3?h((c(),v(V,{key:0,command:"refund"},{default:n(()=>[...t[21]||(t[21]=[d("退款",-1)])]),_:1})),[[w,"order:refund"]]):Y("",!0),[4,6].includes(l.row.status)?h((c(),v(V,{key:1,command:"resend"},{default:n(()=>[...t[22]||(t[22]=[d("补单",-1)])]),_:1})),[[w,"order:resend"]]):Y("",!0),l.row.status===3?h((c(),v(V,{key:2,command:"callback"},{default:n(()=>[...t[23]||(t[23]=[d("回调",-1)])]),_:1})),[[w,"order:callback"]]):Y("",!0)]),_:2},1024)]),default:n(()=>[a(S,{size:"small",type:"primary"},{default:n(()=>[t[18]||(t[18]=d(" 操作",-1)),a(z,{class:"el-icon--right"},{default:n(()=>[a(i(ot))]),_:1})]),_:1})]),_:2},1032,["onCommand"])]),_:1})]),_:1},8,["data","onSelectionChange"])]),r("div",Bt,[r("div",Ft,[a(Be,{"current-page":i(f).current_page,"onUpdate:currentPage":t[5]||(t[5]=l=>i(f).current_page=l),"page-size":i(f).page_size,"onUpdate:pageSize":t[6]||(t[6]=l=>i(f).page_size=l),"page-sizes":[10,50,100,200],background:!0,"prev-text":"上一页","next-text":"下一页",layout:"total, sizes, prev, pager, next, jumper",total:i(f).page_total,onSizeChange:i(ie),onCurrentChange:i(de)},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])],64)}}}),Ht=it(Ot,[["__scopeId","data-v-9f59d254"]]);export{Ht as default};
//# sourceMappingURL=home-BIMwgSHz.js.map
