const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/detail-CFx0tHIF.js","assets/index-Cc4fVNof.js","assets/index-BhGs_Rzi.css","assets/orderManagement-CBcsPuPb.js","assets/detail-CoVh6DoR.css","assets/loading-oV0W9nDj.css","assets/empty-iVBaPuAw.css","assets/table-column-DHEyVPoW.css","assets/checkbox-CXazyT-T.css"])))=>i.map(i=>d[i]);
import{d as he,g as q,y as be,c as B,a,e as p,u as o,w as t,T as ye,D as f,h as ve,M as v,F as we,v as xe,z as ke,A as Ce,C as Te,ay as Ee,o as m,al as Ve,a6 as Se,i as De,E as Re,b as qe,k as Be,l as Me,ah as $e,aj as ze,az as Fe,t as c,m as Ue,J as M,H as P,a7 as Ie,G as Pe,K as Ye,Y as S,X as Ne,aR as Ae,aS as He,aT as Oe,j as $,aU as Le,am as Y,x as i,s as E,aM as C,au as je,_ as Ge}from"./index-Cc4fVNof.js";/* empty css                   *//* empty css               *//* empty css                     *//* empty css                 *//* empty css                          */import{u as Je}from"./table.plugin-BwCM5ljf.js";const Ke={class:"table-com-search"},Qe={class:"search-header"},Xe={class:"search-title"},We={class:"search-buttons"},Ze={class:"table-header ba-scroll-style"},ea={class:"table-search"},aa={style:{width:"100%","overflow-x":"auto"},class:"table-content"},ta={key:0},sa={key:1},na={class:"table-footer"},la={class:"table-pagination"},ra=he({__name:"home",setup(oa){const N=Ve(()=>Y(()=>import("./detail-CFx0tHIF.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),D=q(null),A=(s={})=>{console.log(s),je(()=>{D.value?D.value.open({...s}):console.error("DetailForm 组件未正确挂载！")})},{handleSelectionChange:H,hasSelectedRows:V,isVisible:O,toggleVisibility:z,loadData:L,data:g,refreshData:_,handleSizeChange:j,handleCurrentChange:G,searchParams:w}=Je("/api/v1/admin/order");w.value.search||(w.value.search={});const J=()=>{w.value.search||(w.value.search={order_no:"",merchant_order_no:"",merchant_id:"",status:"",product_name:"",start_time:"",end_time:""})},d=q({order_no:"",merchant_order_no:"",merchant_id:"",status:"",product_name:"",timeRange:null}),R=q(!1),K=async()=>{R.value=!0;try{let s={...d.value};s.timeRange&&s.timeRange.length===2&&(s.start_time=s.timeRange[0],s.end_time=s.timeRange[1]),delete s.timeRange,delete s.quickTime,w.value.search=s,await _()}catch(s){console.error("搜索失败:",s),i.error("搜索失败，请重试")}finally{R.value=!1}},Q=()=>{d.value={order_no:"",merchant_order_no:"",merchant_id:"",status:"",product_name:"",timeRange:null},w.value.search={...d.value},_()};be(()=>{J(),L()});const F=s=>({1:"待支付",2:"支付中",3:"支付成功",4:"支付失败",5:"已退款",6:"已关闭"})[s]||"未知状态",X=s=>({1:"warning",2:"primary",3:"success",4:"danger",5:"info",6:"info"})[s]||"info",W=s=>({0:"未通知",1:"通知成功",2:"通知失败"})[s]||"未知状态",Z=s=>({0:"warning",1:"success",2:"danger"})[s]||"info",ee=async s=>{try{await C.confirm(`确定要退款订单 ${s.order_no} 吗？`,"确认退款",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const{refundOrder:e}=await Y(async()=>{const{refundOrder:l}=await import("./orderManagement-CBcsPuPb.js");return{refundOrder:l}},__vite__mapDeps([3,1,2])),n=await e("/api/v1/admin/order/refund",{order_id:s.id,reason:"管理员退款"});n.status?(i.success("退款申请已提交"),_()):i.error(n.message)}catch(e){e!=="cancel"&&i.error("退款申请失败")}},ae=async s=>{try{await C.confirm(`确定要补单 ${s.order_no} 吗？`,"确认补单",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await E.post("/api/v1/admin/order/reissue",{ids:[s.id]});e.code===200?(i.success("补单成功"),_()):i.error(e.msg)}catch{i.error("补单失败")}},te=async s=>{try{await C.confirm(`确定要重新回调 ${s.order_no} 吗？`,"确认回调",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await E.post("/api/v1/admin/order/callback",{ids:[s.id]});e.code===200?(i.success("回调成功"),_()):i.error(e.msg)}catch{i.error("回调失败")}},se=async()=>{var s;if(!V.value){i.warning("请选择要补单的订单");return}try{await C.confirm("确定要批量补单选中的订单吗？","确认批量补单",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await E.post("/api/v1/admin/order/reissue",{ids:((s=g.value.selectedRows)==null?void 0:s.map(n=>n.id))||[]});e.code===200?(i.success("批量补单成功"),_()):i.error(e.msg)}catch{i.error("批量补单失败")}},ne=async()=>{var s;if(!V.value){i.warning("请选择要回调的订单");return}try{await C.confirm("确定要批量回调选中的订单吗？","确认批量回调",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await E.post("/api/v1/admin/order/callback",{ids:((s=g.value.selectedRows)==null?void 0:s.map(n=>n.id))||[]});e.code===200?(i.success("批量回调成功"),_()):i.error(e.msg)}catch{i.error("批量回调失败")}},le=(s,e)=>{switch(s){case"detail":A(e);break;case"query":re(e);break;case"refund":ee(e);break;case"resend":ae(e);break;case"callback":te(e);break;default:console.warn("未知操作:",s)}},re=async s=>{try{const e=await E.post("/api/v1/admin/order/query",{order_no:s.order_no});if(e.code===200){const n=e.data;let l=`📋 订单信息
`;l+=`═══════════════════════════════════════════════════════════
`,l+=`🔢 订单号：${n.order_no}
`,l+=`📊 当前状态：${F(n.status)}
`,l+=`💰 订单金额：¥${(n.amount/100).toFixed(2)}
`,l+=`📅 创建时间：${new Date(n.created_at).toLocaleString()}

`,l+=`🔍 支付通道查询结果
`,l+=`───────────────────────────────────────────────────────────
`,n.query_success?(l+=`✅ 查询状态：成功
`,n.query_result&&n.query_result.unified_status_text?l+=`📊 当前状态：${n.query_result.unified_status_text}
`:l+=`📊 当前状态：${n.query_message}
`,n.query_result&&n.query_result.unified_status_text&&(l+=`
📋 状态详情：
`,l+=`───────────────────────────────────────────────────────────
`,l+=`🎯 统一状态：${n.query_result.unified_status_text}
`,l+=`📝 原始状态：${n.query_result.original_status||"未知"}
`,l+=`📊 状态字段：${n.query_result.original_status_field||"status"}
`,l+=`🏢 供货商类型：${n.query_result.supplier_type||"未知"}
`),n.query_result&&Object.keys(n.query_result).length>0||(l+=`
📄 通道返回数据：无数据
`)):(l+=`❌ 查询状态：失败
`,l+=`⚠️  错误信息：${n.query_message}
`),l+=`
═══════════════════════════════════════════════════════════`;const x=l.replace(/\n/g,"<br>").replace(/`([^`]+)`/g,"<code>$1</code>");C.alert(x,"🔍 查单结果",{confirmButtonText:"确定",type:n.query_success?"success":"warning",dangerouslyUseHTMLString:!0,customStyle:{"max-width":"900px","max-height":"700px",overflow:"auto","font-family":"monospace","line-height":"1.6","white-space":"pre-wrap","word-break":"break-all"}})}else console.error("查单API返回错误：",e),i.error(e.msg||"查单失败")}catch(e){console.error("查单请求异常：",e),i.error("查单失败："+(e.message||"网络错误"))}};return(s,e)=>{const n=Ue,l=xe,x=Me,b=Be,y=qe,k=ze,oe=$e,U=Re,ie=Fe,de=De,ce=Se,ue=ke,u=Ye,I=Ne,T=Le,me=Oe,_e=Ae,pe=Ce,fe=Te,h=Ee("permission");return m(),B(we,null,[a(o(N),{ref_key:"detailFormRef",ref:D,onRefresh:o(_)},null,8,["onRefresh"]),a(ye,{name:"fade"},{default:t(()=>[f(p("div",Ke,[a(ce,{class:"search-card",shadow:"never"},{header:t(()=>[p("div",Qe,[p("span",Xe,[a(n,null,{default:t(()=>[a(o(M))]),_:1}),e[8]||(e[8]=c(" 订单搜索 ",-1))]),a(l,{type:"text",onClick:o(z),class:"close-btn"},{default:t(()=>[a(n,null,{default:t(()=>[a(o(Ie))]),_:1})]),_:1},8,["onClick"])])]),default:t(()=>[a(de,{model:d.value,"label-width":"100px",class:"search-form"},{default:t(()=>[a(U,{gutter:20},{default:t(()=>[a(y,{span:6},{default:t(()=>[a(b,{label:"订单号"},{default:t(()=>[a(x,{modelValue:d.value.order_no,"onUpdate:modelValue":e[0]||(e[0]=r=>d.value.order_no=r),placeholder:"请输入订单号",clearable:"","prefix-icon":"Search"},null,8,["modelValue"])]),_:1})]),_:1}),a(y,{span:6},{default:t(()=>[a(b,{label:"商户订单号"},{default:t(()=>[a(x,{modelValue:d.value.merchant_order_no,"onUpdate:modelValue":e[1]||(e[1]=r=>d.value.merchant_order_no=r),placeholder:"请输入商户订单号",clearable:"","prefix-icon":"Search"},null,8,["modelValue"])]),_:1})]),_:1}),a(y,{span:6},{default:t(()=>[a(b,{label:"商户ID"},{default:t(()=>[a(x,{modelValue:d.value.merchant_id,"onUpdate:modelValue":e[2]||(e[2]=r=>d.value.merchant_id=r),placeholder:"请输入商户ID",clearable:"","prefix-icon":"User"},null,8,["modelValue"])]),_:1})]),_:1}),a(y,{span:6},{default:t(()=>[a(b,{label:"订单状态"},{default:t(()=>[a(oe,{modelValue:d.value.status,"onUpdate:modelValue":e[3]||(e[3]=r=>d.value.status=r),placeholder:"请选择订单状态",clearable:"",style:{width:"100%"}},{default:t(()=>[a(k,{label:"待支付",value:1}),a(k,{label:"支付中",value:2}),a(k,{label:"支付成功",value:3}),a(k,{label:"支付失败",value:4}),a(k,{label:"已退款",value:5}),a(k,{label:"已关闭",value:6})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(U,{gutter:20},{default:t(()=>[a(y,{span:6},{default:t(()=>[a(b,{label:"支付产品"},{default:t(()=>[a(x,{modelValue:d.value.product_name,"onUpdate:modelValue":e[4]||(e[4]=r=>d.value.product_name=r),placeholder:"请输入产品名称",clearable:"","prefix-icon":"Goods"},null,8,["modelValue"])]),_:1})]),_:1}),a(y,{span:6},{default:t(()=>[a(b,{label:"时间范围"},{default:t(()=>[a(ie,{modelValue:d.value.timeRange,"onUpdate:modelValue":e[5]||(e[5]=r=>d.value.timeRange=r),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(y,{span:6},{default:t(()=>[a(b,null,{default:t(()=>[p("div",We,[a(l,{type:"primary",onClick:K,loading:R.value},{default:t(()=>[a(n,null,{default:t(()=>[a(o(M))]),_:1}),e[9]||(e[9]=c(" 搜索 ",-1))]),_:1},8,["loading"]),a(l,{onClick:Q},{default:t(()=>[a(n,null,{default:t(()=>[a(o(P))]),_:1}),e[10]||(e[10]=c(" 重置 ",-1))]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[Pe,o(O)]])]),_:1}),p("div",Ze,[f(a(l,{icon:o(P),onClick:o(_),color:"#40485b"},null,8,["icon","onClick"]),[[h,"order:list"]]),f((m(),v(l,{type:"primary",disabled:!o(V),onClick:se},{default:t(()=>[...e[11]||(e[11]=[c("补单",-1)])]),_:1},8,["disabled"])),[[h,"order:resend"]]),f((m(),v(l,{type:"primary",disabled:!o(V),onClick:ne},{default:t(()=>[...e[12]||(e[12]=[c("回调",-1)])]),_:1},8,["disabled"])),[[h,"order:callback"]]),e[13]||(e[13]=ve('<div class="table-statistics" data-v-a63c5499><span class="stat-item stat-highlight" data-v-a63c5499>累计订单数: <b class="stat-number" data-v-a63c5499>150</b></span><span class="stat-item stat-highlight" data-v-a63c5499>订单总金额: <b class="stat-number" data-v-a63c5499>￥8000.00</b></span><span class="stat-item stat-success" data-v-a63c5499>已付订单数: <b class="stat-number" data-v-a63c5499>100</b></span><span class="stat-item stat-success" data-v-a63c5499>已付总金额: <b class="stat-number" data-v-a63c5499>￥6000.00</b></span><span class="stat-item stat-info" data-v-a63c5499>商户总收入: <b class="stat-number" data-v-a63c5499>￥5976.00</b></span><span class="stat-item stat-warning" data-v-a63c5499>未付订单数: <b class="stat-number" data-v-a63c5499>50</b></span><span class="stat-item stat-warning" data-v-a63c5499>未付总金额: <b class="stat-number" data-v-a63c5499>￥2000.00</b></span><span class="stat-item stat-success" data-v-a63c5499>成功率: <b class="stat-number" data-v-a63c5499>66.67%</b></span></div>',1)),p("div",ea,[a(ue,{class:"ml-4"},{default:t(()=>[a(l,{icon:o(M),onClick:o(z)},null,8,["icon","onClick"])]),_:1})])]),p("div",aa,[a(pe,{data:o(g).data,border:"",stripe:"","max-height":"600",style:{width:"100%"},onSelectionChange:o(H)},{default:t(()=>[a(u,{type:"selection",width:"40"}),a(u,{prop:"order_no",label:"平台单号",align:"center","min-width":"200"}),a(u,{prop:"merchant_order_no",label:"商户单号",align:"center","min-width":"167"}),a(u,{prop:"amount",label:"订单金额",align:"center","min-width":"100"},{default:t(({row:r})=>[c(" ¥"+S((r.amount/100).toFixed(2)),1)]),_:1}),a(u,{label:"支付状态",align:"center","min-width":"100"},{default:t(({row:r})=>[a(I,{type:X(r.status)},{default:t(()=>[c(S(F(r.status)),1)]),_:2},1032,["type"])]),_:1}),a(u,{prop:"notify_status",label:"回调状态",align:"center","min-width":"100"},{default:t(({row:r})=>[a(I,{type:Z(r.notify_status),size:"small"},{default:t(()=>[c(S(W(r.notify_status)),1)]),_:2},1032,["type"])]),_:1}),a(u,{prop:"merchant.merchant_name",label:"商户名称",align:"center","min-width":"150"}),a(u,{label:"通道名称",align:"center","min-width":"120"},{default:t(({row:r})=>[r.channel?(m(),B("span",ta,S(r.channel.channel_name||"百亿支付"),1)):(m(),B("span",sa," 百亿支付 "))]),_:1}),a(u,{prop:"paid_time",label:"支付时间",align:"center","min-width":"160"}),a(u,{label:"操作",align:"center",fixed:"right","min-width":"120"},{default:t(r=>[a(_e,{trigger:"click",onCommand:ge=>le(ge,r.row)},{dropdown:t(()=>[a(me,null,{default:t(()=>[f((m(),v(T,{command:"detail"},{default:t(()=>[...e[15]||(e[15]=[c("订单详情",-1)])]),_:1})),[[h,"order:detail"]]),f((m(),v(T,{command:"query"},{default:t(()=>[...e[16]||(e[16]=[c("查单",-1)])]),_:1})),[[h,"order:query"]]),r.row.status===3?f((m(),v(T,{key:0,command:"refund"},{default:t(()=>[...e[17]||(e[17]=[c("退款",-1)])]),_:1})),[[h,"order:refund"]]):$("",!0),[4,6].includes(r.row.status)?f((m(),v(T,{key:1,command:"resend"},{default:t(()=>[...e[18]||(e[18]=[c("补单",-1)])]),_:1})),[[h,"order:resend"]]):$("",!0),r.row.status===3?f((m(),v(T,{key:2,command:"callback"},{default:t(()=>[...e[19]||(e[19]=[c("回调",-1)])]),_:1})),[[h,"order:callback"]]):$("",!0)]),_:2},1024)]),default:t(()=>[a(l,{size:"small",type:"primary"},{default:t(()=>[e[14]||(e[14]=c(" 操作",-1)),a(n,{class:"el-icon--right"},{default:t(()=>[a(o(He))]),_:1})]),_:1})]),_:2},1032,["onCommand"])]),_:1})]),_:1},8,["data","onSelectionChange"])]),p("div",na,[p("div",la,[a(fe,{"current-page":o(g).current_page,"onUpdate:currentPage":e[6]||(e[6]=r=>o(g).current_page=r),"page-size":o(g).page_size,"onUpdate:pageSize":e[7]||(e[7]=r=>o(g).page_size=r),"page-sizes":[10,50,100,200],background:!0,"prev-text":"上一页","next-text":"下一页",layout:"total, sizes, prev, pager, next, jumper",total:o(g).page_total,onSizeChange:o(j),onCurrentChange:o(G)},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])],64)}}}),fa=Ge(ra,[["__scopeId","data-v-a63c5499"]]);export{fa as default};
//# sourceMappingURL=home-DNKEWGmp.js.map
