import{d as M,g as c,a9 as b,aj as S,i as j,w as d,D as v,C as L,o as _,Q as U,c as f,a as p,j as k,e as l,F as z,a1 as F,n as m,t as y,a$ as O,ac as Q,au as G,q as H,aS as J,_ as K}from"./index-Dwi2X-zo.js";/* empty css                *//* empty css                 *//* empty css              */import{d as R,f as W}from"./product-aoAQyEbo.js";const X={"element-loading-text":"加载中..."},Y={key:0,class:"current-product-info mb-4"},Z={class:"product-info"},ee={class:"transfer-container"},ae={class:"product-info"},le={class:"channel-name"},se={key:0,class:"weight-badge"},te={key:0,class:"status-badge"},oe={class:"dialog-footer"},ne=M({__name:"pool",emits:["refresh"],setup(ie,{expose:P,emit:$}){const r=c(!1),h=c(!1),C=c(!1),s=c(null),o=c({assigned:[],unassigned:[]}),D=b(()=>s.value?`轮询池管理 - ${s.value.product_name}`:"轮询池管理"),V=$,B=b(()=>[...o.value.unassigned,...o.value.assigned].map(e=>({key:e.key||e.channel_id,label:e.display_name||`${e.supplier_name}-${e.channel_name}-${e.cost_rate}%`,channel_id:e.channel_id,channel_name:e.channel_name,cost_rate:e.cost_rate,weight:e.weight,min_amount:e.min_amount,max_amount:e.max_amount,interface_code:e.interface_code,supplier_name:e.supplier_name,display_name:e.display_name,status:e.status,is_enabled:e.is_enabled,disabled:!1}))),g=b({get(){return o.value.assigned.map(a=>a.key||a.channel_id)},set(a){const e=[...o.value.unassigned,...o.value.assigned],i=e.filter(n=>a.includes(n.key||n.channel_id)),u=e.filter(n=>!a.includes(n.key||n.channel_id));o.value.assigned=i,o.value.unassigned=u}}),E=(a,e,i)=>{console.log("Transfer changed:",{value:a,direction:e,movedKeys:i}),console.log("Current poolData:",o.value),console.log("Current selectedProducts:",g.value)},T=async(a=null)=>{console.log("Opening pool dialog with product:",a),s.value=a,r.value=!0,await I()},I=async()=>{var a;if(console.log("loadPoolData called, currentProduct:",s.value),!((a=s.value)!=null&&a.id)){console.log("No product ID, skipping API call");return}h.value=!0;try{const e=`/api/v1/admin/product/pool/list?product_id=${s.value.id}`;console.log("Making API request to:",e);const i=await R(e);console.log("API response:",i);const{status:u,data:n}=i;u&&n?(o.value={assigned:n.assigned_channels||[],unassigned:n.available_channels||[]},console.log("Pool data updated:",o.value)):v.error("加载轮询池数据失败")}catch(e){console.error("API request failed:",e),v.error("加载轮询池数据失败")}finally{h.value=!1}},A=async()=>{try{await J.confirm("确定要保存轮询池的更改吗？","确认保存",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),C.value=!0,await W("/api/v1/admin/product/pool/update",{product_id:s.value.id,channel_ids:g.value}),v.success("保存成功"),V("refresh"),r.value=!1}catch(a){a!=="cancel"&&v.error("保存失败")}finally{C.value=!1}},w=()=>{r.value=!1,s.value=null};return S(r,a=>{a||(s.value=null,o.value={assigned:[],unassigned:[]})}),P({open:T}),(a,e)=>{const i=z,u=F,n=O,x=H,N=L,q=G;return _(),j(N,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=t=>r.value=t),title:D.value,width:"70%","before-close":w},{footer:d(()=>[l("div",oe,[p(x,{onClick:w},{default:d(()=>[...e[6]||(e[6]=[m("取消",-1)])]),_:1}),p(x,{type:"primary",onClick:A,loading:C.value},{default:d(()=>[...e[7]||(e[7]=[m("保存",-1)])]),_:1},8,["loading"])])]),default:d(()=>[U((_(),f("div",X,[p(i,{type:"info",closable:!1,"show-icon":"",class:"mb-4"},{default:d(()=>[...e[2]||(e[2]=[l("div",{class:"usage-instructions"},[l("p",null,[l("strong",null,"轮询池管理说明：")]),l("ul",null,[l("li",null,"轮询池中的通道会参与轮询调度，可选通道不会参与"),l("li",null,"可以通过搜索框快速查找特定通道"),l("li",null,'操作完成后请点击"保存"按钮确认更改')])],-1)])]),_:1}),s.value?(_(),f("div",Y,[p(u,null,{header:d(()=>[...e[3]||(e[3]=[l("span",null,"当前产品信息",-1)])]),default:d(()=>[l("div",Z,[l("span",null,[e[4]||(e[4]=l("strong",null,"产品名称：",-1)),m(y(s.value.product_name),1)]),l("span",null,[e[5]||(e[5]=l("strong",null,"对接编号：",-1)),m(y(s.value.external_code),1)])])]),_:1})])):k("",!0),l("div",ee,[p(n,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),data:B.value,titles:["可选通道 (供应商-通道-成本费率)","轮询池 (供应商-通道-成本费率)"],"button-texts":["移除","分配"],format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},filterable:"","filter-placeholder":"请输入产品名称",onChange:E},{default:d(({option:t})=>[l("div",{class:Q(["product-item",{"disabled-channel":!t.is_enabled}])},[l("div",ae,[l("span",le,[m(y(t.display_name||`${t.supplier_name}-${t.channel_name}-${t.cost_rate}%`)+" ",1),t.weight>0?(_(),f("span",se,"权重:"+y(t.weight),1)):k("",!0)]),t.is_enabled?k("",!0):(_(),f("span",te,"未启用"))])],2)]),_:1},8,["modelValue","data"])])])),[[q,h.value]])]),_:1},8,["modelValue","title"])}}}),pe=K(ne,[["__scopeId","data-v-2ae3f651"]]);export{pe as default};
//# sourceMappingURL=pool-CnhIgMGK.js.map
