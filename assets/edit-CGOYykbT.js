import{d as G,g as d,a9 as Z,i as h,w as t,$ as A,C as H,Z as K,o as b,a,x as P,e as s,c as X,j as J,E as L,b as Q,y as W,z as Y,a2 as ee,aa as le,ab as ae,n as v,t as w,X as te,a3 as oe,q as se,u as ne,V as ue,ac as ie,D as f,ad as re,ae as de,_ as me}from"./index-Dwi2X-zo.js";/* empty css                     *//* empty css                    *//* empty css               *//* empty css                    *//* empty css                 *//* empty css             */const pe={class:"form-section"},ce={class:"form-section"},fe={style:{"margin-top":"5px","font-size":"12px",color:"#999"}},_e={class:"form-section"},ve={key:0,class:"form-section"},ge={class:"form-section"},Ve={class:"dialog-footer"},be=G({__name:"edit",emits:["refresh"],setup(we,{expose:E,emit:U}){const p=d(!1),_=d(!1),g=d(null),y=d(0),l=d({id:0,title:"",rule:"",parent_id:"",is_menu:0,weight:0,status:1,remark:"",path:"",icon:""}),C=d({title:[{required:!0,message:"请输入权限名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],rule:[{required:!0,message:"请输入权限标识",trigger:"blur"},{pattern:/^[a-zA-Z0-9:_-]+$/,message:"权限标识只能包含字母、数字、冒号、下划线和横线",trigger:"blur"}],path:[{validator:(o,e,r)=>{l.value.is_menu===1&&!e?r(new Error("菜单类型必须填写前端路径")):r()},trigger:"blur"}]}),c=d([]),x=Z({get:()=>(console.log("获取is_menu值:",l.value.is_menu,typeof l.value.is_menu),l.value.is_menu),set:o=>{console.log("设置is_menu值:",o,typeof o),l.value.is_menu=o,N(o)}}),R=async()=>{try{console.log("开始获取权限树数据...");const o=await K(l.value.id||0);console.log("权限树数据响应:",o),o&&o.data?(c.value=o.data||[],console.log("权限树数据设置成功:",c.value)):(c.value=[],console.log("权限树数据为空，设置为空数组"))}catch(o){console.error("获取用户权限失败:",o),c.value=[]}},N=o=>{console.log("菜单类型变化:",o,typeof o),o===0&&(l.value.path="",l.value.icon="",console.log("已清空路径和图标"))},B=()=>{f.info("常用图标：fa fa-home（首页）、fa fa-user（用户）、fa fa-cog（设置）、fa fa-list（列表）")},D=o=>{if(_.value){f.warning("正在提交中，请稍候...");return}o()},I={label:"title",children:"children"},z=U,M=(o={})=>{if(console.log("接收参数",o),l.value={id:0,title:"",rule:"",parent_id:"",is_menu:0,weight:0,status:1,remark:"",path:"",icon:""},o&&Object.keys(o).length>0){const e={...o};e.parent_id===0&&(e.parent_id=""),e.is_menu!==void 0?(e.is_menu=Number(e.is_menu),console.log("设置is_menu:",e.is_menu,typeof e.is_menu)):e.is_menu=0,e.status!==void 0&&(e.status=Number(e.status)),e.weight!==void 0&&(e.weight=Number(e.weight)),Object.assign(l.value,e),console.log("合并后的表单数据:",l.value)}R(),p.value=!0,A(()=>{console.log("DOM更新后的表单数据:",l.value),l.value={...l.value},y.value++})},S=async()=>{if(g.value)try{await g.value.validate(),_.value=!0;let o;l.value.id==0?o=await re(l.value):o=await de(l.value),o.status?(f.success(o.message),z("refresh"),p.value=!1):f.error(o.message||"操作失败")}catch(o){console.error("提交失败:",o),f.error("提交失败，请检查表单信息")}finally{_.value=!1}};return E({open:M}),(o,e)=>{const r=Y,u=W,i=Q,m=L,j=ee,k=ae,q=le,F=te,O=oe,V=se,T=P,$=H;return b(),h($,{modelValue:p.value,"onUpdate:modelValue":e[10]||(e[10]=n=>p.value=n),title:l.value.id?"编辑权限规则":"添加权限规则",width:"60%","close-on-click-modal":!1,class:"rule-dialog","before-close":D},{footer:t(()=>[s("div",Ve,[a(V,{onClick:e[9]||(e[9]=n=>p.value=!1)},{default:t(()=>[...e[18]||(e[18]=[v("取消",-1)])]),_:1}),a(V,{type:"primary",onClick:S,loading:_.value},{default:t(()=>[v(w(l.value.id?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:t(()=>[a(T,{model:l.value,"label-width":"120px",rules:C.value,ref_key:"formRef",ref:g,class:"rule-form"},{default:t(()=>[s("div",pe,[e[11]||(e[11]=s("div",{class:"section-title"},[s("i",{class:"el-icon-document"}),s("span",null,"基本信息")],-1)),a(m,{gutter:20},{default:t(()=>[a(i,{span:12},{default:t(()=>[a(u,{label:"权限名称",prop:"title"},{default:t(()=>[a(r,{modelValue:l.value.title,"onUpdate:modelValue":e[0]||(e[0]=n=>l.value.title=n),placeholder:"请输入权限名称",clearable:"","prefix-icon":"el-icon-edit"},null,8,["modelValue"])]),_:1})]),_:1}),a(i,{span:12},{default:t(()=>[a(u,{label:"权限标识",prop:"rule"},{default:t(()=>[a(r,{modelValue:l.value.rule,"onUpdate:modelValue":e[1]||(e[1]=n=>l.value.rule=n),placeholder:"如：user:create",clearable:"","prefix-icon":"el-icon-key"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),s("div",ce,[e[14]||(e[14]=s("div",{class:"section-title"},[s("i",{class:"el-icon-setting"}),s("span",null,"权限配置")],-1)),a(m,{gutter:20},{default:t(()=>[a(i,{span:12},{default:t(()=>[a(u,{label:"上级权限",prop:"parent_id"},{default:t(()=>[a(j,{modelValue:l.value.parent_id,"onUpdate:modelValue":e[2]||(e[2]=n=>l.value.parent_id=n),data:c.value,props:I,"node-key":"id","check-strictly":"","default-expand-all":"",placeholder:"请选择上级权限",clearable:"",filterable:"",style:{width:"100%"}},null,8,["modelValue","data"])]),_:1})]),_:1}),a(i,{span:12},{default:t(()=>[a(u,{label:"是否菜单",prop:"is_menu"},{default:t(()=>[(b(),h(q,{modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=n=>x.value=n),key:y.value},{default:t(()=>[a(k,{value:1,class:"menu-radio"},{default:t(()=>[...e[12]||(e[12]=[v("是",-1)])]),_:1}),a(k,{value:0,class:"menu-radio"},{default:t(()=>[...e[13]||(e[13]=[v("否",-1)])]),_:1})]),_:1},8,["modelValue"])),s("div",fe," 调试: "+w(l.value.is_menu)+" ("+w(typeof l.value.is_menu)+") ",1)]),_:1})]),_:1})]),_:1})]),s("div",_e,[e[15]||(e[15]=s("div",{class:"section-title"},[s("i",{class:"el-icon-switch-button"}),s("span",null,"状态配置")],-1)),a(m,{gutter:20},{default:t(()=>[a(i,{span:12},{default:t(()=>[a(u,{label:"状态",prop:"status"},{default:t(()=>[a(F,{modelValue:l.value.status,"onUpdate:modelValue":e[4]||(e[4]=n=>l.value.status=n),"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1}),a(i,{span:12},{default:t(()=>[a(u,{label:"权重",prop:"weight"},{default:t(()=>[a(O,{modelValue:l.value.weight,"onUpdate:modelValue":e[5]||(e[5]=n=>l.value.weight=n),min:0,max:999,style:{width:"100%"},"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),l.value.is_menu===1?(b(),X("div",ve,[e[16]||(e[16]=s("div",{class:"section-title"},[s("i",{class:"el-icon-menu"}),s("span",null,"菜单配置")],-1)),a(m,{gutter:20},{default:t(()=>[a(i,{span:24},{default:t(()=>[a(u,{label:"前端路径",prop:"path"},{default:t(()=>[a(r,{modelValue:l.value.path,"onUpdate:modelValue":e[6]||(e[6]=n=>l.value.path=n),placeholder:"如：/user/list",clearable:"","prefix-icon":"el-icon-link"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(m,{gutter:20},{default:t(()=>[a(i,{span:24},{default:t(()=>[a(u,{label:"显示图标",prop:"icon"},{default:t(()=>[a(r,{modelValue:l.value.icon,"onUpdate:modelValue":e[7]||(e[7]=n=>l.value.icon=n),placeholder:"搜索图标，如：fa fa-home",clearable:""},{prepend:t(()=>[s("i",{class:ie(l.value.icon||"fa fa-circle-o")},null,2)]),append:t(()=>[a(V,{icon:ne(ue),onClick:B},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})])):J("",!0),s("div",ge,[e[17]||(e[17]=s("div",{class:"section-title"},[s("i",{class:"el-icon-edit-outline"}),s("span",null,"其他信息")],-1)),a(m,{gutter:20},{default:t(()=>[a(i,{span:24},{default:t(()=>[a(u,{label:"备注",prop:"remark"},{default:t(()=>[a(r,{modelValue:l.value.remark,"onUpdate:modelValue":e[8]||(e[8]=n=>l.value.remark=n),type:"textarea",rows:3,placeholder:"请输入备注信息",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Re=me(be,[["__scopeId","data-v-26fa8a71"]]);export{Re as default};
//# sourceMappingURL=edit-CGOYykbT.js.map
