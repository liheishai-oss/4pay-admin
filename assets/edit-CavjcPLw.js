import{d as U,g as f,aj as B,i as q,w as o,D as m,ao as C,o as b,Q as I,c as P,a as l,u as S,x as j,ap as z,n as p,y as R,z as L,a3 as M,X as O,e as Q,q as T,au as X,_ as $}from"./index-Dwi2X-zo.js";/* empty css                *//* empty css                     */import{g as A,e as G,b as H}from"./product-aoAQyEbo.js";const J={"element-loading-text":"加载中..."},K=U({__name:"edit",emits:["refresh"],setup(W,{expose:g,emit:V}){const d=f(!1),_=f(),n=f(!1),t=f({id:0,product_name:"",external_code:"",sort:0,status:1,default_rate:0,remark:""}),x=V,w=f({product_name:[{required:!0,message:"请输入产品名称",trigger:"blur"}],sort:[{required:!0,message:"请输入排序值",trigger:"blur"}],default_rate:[{required:!1,message:"请输入默认费率",trigger:"blur"},{validator:(s,e,a)=>{e&&(isNaN(Number(e))||Number(e)<0||Number(e)>100)?a(new Error("费率范围0-100%")):a()},trigger:"blur"}]}),E=async(s={})=>{v(),n.value=!0;try{const e=s||{};let a={...e};if(e&&e.id&&typeof e.id=="number"&&e.id>0)try{const r=await A("/api/v1/admin/product/detail",e.id);if(r.status&&r.data)a={...r.data};else{m.error("获取产品详情失败");return}}catch{m.error("获取产品详情失败");return}Object.keys(a).forEach(r=>{a[r]!==void 0&&a[r]!==null&&a[r]!==""&&(t.value[r]=a[r])}),!e||!e.id||e.id<=0?(t.value.id=0,t.value.status=1,t.value.sort=0,t.value.default_rate=0,t.value.remark="",t.value.external_code=""):a.default_rate_bp&&(t.value.default_rate=parseFloat(a.default_rate_bp.toFixed(2))),d.value=!0}catch{m.error("加载数据失败")}finally{n.value=!1}},y=async()=>{var s;try{await((s=_.value)==null?void 0:s.validate());const e={...t.value};e.default_rate?e.default_rate_bp=parseFloat(e.default_rate.toString()):e.default_rate_bp=0,delete e.default_rate,delete e.id,delete e.external_code,n.value=!0;let a;t.value.id>0?a=await G("/api/v1/admin/product/edit",e):a=await H("/api/v1/admin/product/add",e),a.status?(m.success(a.message||"操作成功"),x("refresh"),d.value=!1):m.error(a.message||"操作失败")}catch{m.error("提交失败，请检查表单信息")}finally{n.value=!1}},v=()=>{t.value={id:0,product_name:"",external_code:"",sort:0,status:1,default_rate:0,remark:""}};return B(d,(s,e)=>{e===!0&&s===!1&&v()}),g({open:E}),(s,e)=>{const a=z,r=L,i=R,N=M,k=O,c=T,D=C,F=X;return b(),q(D,{modelValue:d.value,"onUpdate:modelValue":e[6]||(e[6]=u=>d.value=u),title:t.value.id>0?"编辑产品":"新增产品",size:"50%"},{default:o(()=>[I((b(),P("div",J,[l(S(j),{model:t.value,rules:w.value,ref_key:"formRef",ref:_,"label-width":"150px"},{default:o(()=>[l(a,{"content-position":"left"},{default:o(()=>[...e[7]||(e[7]=[p("基本信息",-1)])]),_:1}),l(i,{label:"产品名称",prop:"product_name"},{default:o(()=>[l(r,{modelValue:t.value.product_name,"onUpdate:modelValue":e[0]||(e[0]=u=>t.value.product_name=u),placeholder:"请输入产品名称"},null,8,["modelValue"])]),_:1}),l(i,{label:"排序",prop:"sort"},{default:o(()=>[l(N,{modelValue:t.value.sort,"onUpdate:modelValue":e[1]||(e[1]=u=>t.value.sort=u),min:0,max:999999,placeholder:"数值越大越靠前"},null,8,["modelValue"])]),_:1}),l(i,{label:"状态",prop:"status"},{default:o(()=>[l(k,{modelValue:t.value.status,"onUpdate:modelValue":e[2]||(e[2]=u=>t.value.status=u),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),l(a,{"content-position":"left"},{default:o(()=>[...e[8]||(e[8]=[p("费率配置",-1)])]),_:1}),l(i,{label:"默认费率",prop:"default_rate"},{default:o(()=>[l(r,{modelValue:t.value.default_rate,"onUpdate:modelValue":e[3]||(e[3]=u=>t.value.default_rate=u),placeholder:"请输入默认费率"},{append:o(()=>[...e[9]||(e[9]=[p("%",-1)])]),_:1},8,["modelValue"]),e[10]||(e[10]=Q("div",{class:"form-tip"},"例如：1.5 表示 1.5%",-1))]),_:1}),l(a,{"content-position":"left"},{default:o(()=>[...e[11]||(e[11]=[p("其他信息",-1)])]),_:1}),l(i,{label:"备注",prop:"remark"},{default:o(()=>[l(r,{modelValue:t.value.remark,"onUpdate:modelValue":e[4]||(e[4]=u=>t.value.remark=u),type:"textarea",placeholder:"请输入备注信息",rows:3},null,8,["modelValue"])]),_:1}),l(i,null,{default:o(()=>[l(c,{type:"primary",onClick:y,loading:n.value},{default:o(()=>[...e[12]||(e[12]=[p("提交",-1)])]),_:1},8,["loading"]),l(c,{onClick:e[5]||(e[5]=u=>d.value=!1)},{default:o(()=>[...e[13]||(e[13]=[p("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model","rules"])])),[[F,n.value]])]),_:1},8,["modelValue","title"])}}}),te=$(K,[["__scopeId","data-v-87664cba"]]);export{te as default};
//# sourceMappingURL=edit-CavjcPLw.js.map
