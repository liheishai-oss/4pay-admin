{"version":3,"file":"edit-T90rdefR.js","sources":["../../src/pages/merchant/edit.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { ref, watch, computed } from 'vue'\nimport { ElMessage, ElForm } from 'element-plus'\n\nimport {addMerchant, editMerchant, getMerchantDetail} from \"@/api/merchant.ts\";\n\nconst visible = ref(false)\nconst formRef = ref<InstanceType<typeof ElForm>>()\nconst loading = ref(false)\n\nconst form = ref({\n  id: 0,\n  login_account: \"\",\n  merchant_name: \"\",\n  status: 1,\n  whitelist_ips: \"\",\n})\n\n\nconst emit = defineEmits<{\n  (event: 'refresh'): void\n}>()\n\n// ÂÆö‰πâËßÑÂàô\nconst rules = ref({\n  login_account: [{ required: true, message: 'ËØ∑ËæìÂÖ•ÁôªÂΩïË¥¶Âè∑', trigger: 'blur' }],\n  merchant_name: [{ required: true, message: 'ËØ∑ËæìÂÖ•ÂïÜÊà∑ÂêçÁß∞', trigger: 'blur' }],\n})\n\nconst open = async (data: any = {}) => {\n  console.log('üîç EditForm open called', { \n    data, \n    visible: visible.value,\n    loading: loading.value \n  });\n  \n  // ÂÖàÈáçÁΩÆË°®Âçï\n  resetForm()\n  loading.value = true\n  \n  try {\n    // Á°Æ‰øù data ‰∏ç‰∏∫ null Êàñ undefined\n    const safeData = data || {}\n    let merged: any = { ...safeData }\n    \n    // Ê£ÄÊü•ÊòØÂê¶ÊúâÊúâÊïàÁöÑ id ‰∏îÂ§ß‰∫é 0\n    if (safeData && safeData.id && typeof safeData.id === 'number' && safeData.id > 0) {\n      // ÁºñËæëÊ®°ÂºèÔºö‰ªéËØ¶ÊÉÖËé∑ÂèñÊï∞ÊçÆ\n      try {\n        const res = await getMerchantDetail('/api/v1/admin/merchant/detail', safeData.id)\n        if (res.status && res.data) {\n          merged = { ...res.data }\n        } else {\n          ElMessage.error('Ëé∑ÂèñÂïÜÊà∑ËØ¶ÊÉÖÂ§±Ë¥•')\n          return\n        }\n      } catch (error) {\n        ElMessage.error('Ëé∑ÂèñÂïÜÊà∑ËØ¶ÊÉÖÂ§±Ë¥•')\n        return\n      }\n    }\n\n    // Â§ÑÁêÜÈáëÈ¢ùÂ≠óÊÆµÔºöÂàÜËΩ¨ÂÖÉÊòæÁ§∫Ôºà‰ªÖÂú®ÁºñËæëÊ®°Âºè‰∏ãÔºâ\n    if (safeData && safeData.id && typeof safeData.id === 'number' && safeData.id > 0) {\n      if (merged.withdraw_fee) {\n        merged.withdraw_fee = formatAmount(merged.withdraw_fee)\n      }\n      // Â§ÑÁêÜË¥πÁéáÂ≠óÊÆµÔºöËΩ¨Êç¢‰∏∫ÁôæÂàÜÊØîÊòæÁ§∫\n      if (merged.withdraw_rate) {\n        merged.withdraw_rate = formatRate(merged.withdraw_rate)\n      }\n    }\n\n    // Âè™Êõ¥Êñ∞ÊúâÂÄºÁöÑÂ≠óÊÆµ\n    Object.keys(merged).forEach(key => {\n      if (merged[key] !== undefined && merged[key] !== null && merged[key] !== '') {\n        (form.value as any)[key] = merged[key]\n      }\n    })\n    \n    // Â¶ÇÊûúÊòØÊñ∞Â¢ûÊ®°ÂºèÔºåÁ°Æ‰øùË°®ÂçïÊúâÊ≠£Á°ÆÁöÑÈªòËÆ§ÂÄº\n    if (!safeData || !safeData.id || safeData.id <= 0) {\n      form.value.id = 0\n      form.value.status = 1\n      form.value.withdraw_fee = 0\n      form.value.withdraw_rate = 0\n      form.value.withdraw_config_type = 1\n      form.value.whitelist_ips = \"\"\n    }\n    visible.value = true\n  } catch (error) {\n    ElMessage.error('Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•')\n  } finally {\n    loading.value = false\n  }\n}\n\nconst handleSubmit = async () => {\n  try {\n    await formRef.value?.validate()\n\n    // ÂáÜÂ§áÊèê‰∫§Êï∞ÊçÆ\n    const submitData = { ...form.value }\n    \n    // Ê†πÊçÆÈÖçÁΩÆÁ±ªÂûãÂ§ÑÁêÜÁõ∏Â∫îÂ≠óÊÆµ\n    if (form.value.withdraw_config_type === 2) {\n      // ÂçïÁ¨îÂõ∫ÂÆöÔºöÂ§ÑÁêÜÊèêÁé∞ÊâãÁª≠Ë¥π\n      submitData.withdraw_fee = parseAmount(submitData.withdraw_fee.toString())\n      submitData.withdraw_rate = 0 // Ë¥πÁéáËÆæ‰∏∫0\n    } else if (form.value.withdraw_config_type === 3) {\n      // ÂçïÁ¨îÊØî‰æãÔºöÂ§ÑÁêÜÊèêÁé∞Ë¥πÁéá\n      submitData.withdraw_rate = parseRate(submitData.withdraw_rate.toString())\n      submitData.withdraw_fee = 0 // ÊâãÁª≠Ë¥πËÆæ‰∏∫0\n    } else {\n      // Á≥ªÁªüËßÑÂàôÔºöÈÉΩËÆæ‰∏∫0\n      submitData.withdraw_fee = 0\n      submitData.withdraw_rate = 0\n    }\n\n    loading.value = true\n    let res: any\n    if (form.value.id > 0) {\n      res = await editMerchant('/api/v1/admin/merchant/edit', submitData)\n    } else {\n      res = await addMerchant('/api/v1/admin/merchant/add', submitData)\n    }\n\n    if (res.status) {\n      ElMessage.success(res.message || 'Êìç‰ΩúÊàêÂäü')\n      emit('refresh')\n      visible.value = false\n    } else {\n      ElMessage.error(res.message || 'Êìç‰ΩúÂ§±Ë¥•')\n    }\n  } catch (error) {\n    ElMessage.error('Êèê‰∫§Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Ë°®Âçï‰ø°ÊÅØ')\n  } finally {\n    loading.value = false\n  }\n}\n\n// ÈáçÁΩÆË°®ÂçïÊï∞ÊçÆ\nconst resetForm = () => {\n  form.value = {\n    id: 0,\n    login_account: \"\",\n    merchant_name: \"\",\n    status: 1,\n    withdraw_config_type: 1,\n    withdraw_fee: 0,\n    withdraw_rate: 0,\n    whitelist_ips: \"\",\n  }\n}\n\n// ÁõëÂê¨ visible ÂèòÂåñÔºåÂÖ≥Èó≠Êó∂ÈáçÁΩÆË°®Âçï\nwatch(visible, (newVal, oldVal) => {\n  // Âè™ÊúâÂú®‰ªé true Âèò‰∏∫ false Êó∂ÊâçÈáçÁΩÆË°®Âçï\n  if (oldVal === true && newVal === false) {\n    resetForm()\n  }\n})\n\ndefineExpose({ open })\n</script>\n\n<template>\n  <el-drawer v-model=\"visible\" :title=\"form.id > 0 ? 'ÁºñËæëÂïÜÊà∑' : 'Êñ∞Â¢ûÂïÜÊà∑'\" size=\"50%\">\n    <div v-loading=\"loading\" element-loading-text=\"Âä†ËΩΩ‰∏≠...\">\n      <el-form :model=\"form\" :rules=\"rules\" ref=\"formRef\" label-width=\"150px\">\n        <!-- Âü∫Êú¨‰ø°ÊÅØ -->\n        <el-divider content-position=\"left\">Âü∫Êú¨‰ø°ÊÅØ</el-divider>\n        <el-form-item label=\"ÁôªÂΩïË¥¶Âè∑\" prop=\"login_account\">\n          <el-input v-model=\"form.login_account\" placeholder=\"ËØ∑ËæìÂÖ•ÁôªÂΩïË¥¶Âè∑\" />\n        </el-form-item>\n        \n        <el-form-item label=\"ÂïÜÊà∑ÂêçÁß∞\" prop=\"merchant_name\">\n          <el-input v-model=\"form.merchant_name\" placeholder=\"ËØ∑ËæìÂÖ•ÂïÜÊà∑ÂêçÁß∞\" />\n        </el-form-item>\n        \n        <el-form-item label=\"Áä∂ÊÄÅ\" prop=\"status\">\n          <el-switch v-model=\"form.status\" :active-value=\"1\" :inactive-value=\"0\" />\n        </el-form-item>\n\n        <!-- ÁôΩÂêçÂçïIP -->\n        <el-form-item label=\"ÁôΩÂêçÂçïIP\">\n          <el-input \n            v-model=\"form.whitelist_ips\" \n            type=\"textarea\" \n            placeholder=\"ËØ∑ËæìÂÖ•IPÂú∞ÂùÄÔºåÂ§ö‰∏™IPÁî®|ÂàÜÈöîÔºå‰æãÂ¶ÇÔºö192.168.1.1|192.168.1.2|10.0.0.1\"\n            :rows=\"3 as number\"\n          />\n        </el-form-item>\n\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"handleSubmit\" :loading=\"loading\">Êèê‰∫§</el-button>\n          <el-button @click=\"visible = false\">ÂèñÊ∂à</el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n  </el-drawer>\n</template>\n\n<style scoped>\n.el-form-item {\n  margin-bottom: 20px;\n}\n\n:deep(.el-divider__text) {\n  font-weight: 600;\n  color: #409eff;\n}\n\n:deep(.el-form-item__label) {\n  font-weight: 500;\n}\n\n:deep(.el-input-number) {\n  width: 100%;\n}\n\n:deep(.el-select) {\n  width: 100%;\n}\n\n:deep(.el-textarea) {\n  width: 100%;\n}\n</style>\n"],"names":["visible","ref","formRef","loading","form","emit","__emit","rules","open","data","resetForm","safeData","merged","res","getMerchantDetail","ElMessage","key","handleSubmit","_a","submitData","editMerchant","addMerchant","watch","newVal","oldVal","__expose","_createBlock","_component_el_drawer","$event","_withDirectives","_openBlock","_createElementBlock","_hoisted_1","_createVNode","_unref","ElForm","_component_el_divider","_cache","_component_el_form_item","_component_el_input","_component_el_switch","_component_el_button"],"mappings":"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"}