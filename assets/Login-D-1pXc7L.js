import{s as G,d as K,g as t,h as O,i as W,o as g,w as l,e as s,c as C,j as R,a as o,k as X,u as y,l as j,m as oe,n as $,t as H,p as se,q as N,v as F,x as M,y as T,z as Q,A as le,C as b,D as Y,_ as Z,F as ee,G as ae,H as L,I as te,J as ne,K as re}from"./index-BpE__OAv.js";/* empty css                 *//* empty css              */function de(q={}){return G({url:"/api/v1/admin/user/login",method:"post",data:q})}const J=q=>G.get("/api/v1/admin/google-auth/qr-code",{params:{admin_id:q}}),ie=q=>G.post("/api/v1/admin/google-auth/bind",q),ue={class:"google-auth-bind"},ce={key:0,class:"step-content"},pe={class:"step-header"},_e={class:"qr-code-container"},me={key:0,class:"qr-loading"},fe={key:1,class:"qr-code"},ge=["src"],ve={class:"qr-info"},we={key:2,class:"qr-error"},he={class:"step-actions"},ye={key:1,class:"step-content"},be={class:"step-header"},Ve={class:"step-actions"},ke={key:2,class:"step-content"},Ce={class:"success-content"},xe=K({__name:"GoogleAuthBind",emits:["success","close"],setup(q,{expose:v,emit:w}){const S=w,_=t(!1),c=t(1),h=t(!1),p=t(!1),x=t(0),f=t(null),V=O({google_code:""}),E={google_code:[{required:!0,message:"请输入验证码",trigger:"blur"},{pattern:/^\d{6}$/,message:"请输入6位数字验证码",trigger:"blur"}]},m=t(),a=(d,e)=>{_.value=!0,c.value=1,x.value=d,B()},r=()=>{c.value<3&&c.value++},U=()=>{c.value>1&&c.value--},B=async()=>{try{h.value=!0;const d=await J(x.value);d.data?f.value=d.data:b.error("生成二维码失败")}catch(d){console.error("生成二维码失败:",d),b.error("生成二维码失败")}finally{h.value=!1}},I=async()=>{var d,e;try{await((d=m.value)==null?void 0:d.validate()),p.value=!0;const i=await ie({admin_id:x.value,google_code:V.google_code,secret:f.value.secret});i.data?(b.success("绑定成功"),c.value=3):b.error(((e=i.data)==null?void 0:e.message)||"绑定失败")}catch(i){console.error("绑定失败:",i),b.error(i.message||"绑定失败")}finally{p.value=!1}},n=()=>{_.value=!1,S("success"),setTimeout(()=>{window.location.reload()},1e3)};return v({open:a}),(d,e)=>{const i=X,k=N,z=Q,u=T,D=M,A=Y;return g(),W(A,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=P=>_.value=P),title:"绑定谷歌验证码",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,center:""},{default:l(()=>[s("div",ue,[c.value===1?(g(),C("div",ce,[s("div",pe,[o(i,{class:"step-icon"},{default:l(()=>[o(y(j))]),_:1}),e[2]||(e[2]=s("h3",null,"扫描二维码",-1)),e[3]||(e[3]=s("p",null,"请使用谷歌验证器扫描下方二维码",-1))]),s("div",_e,[h.value?(g(),C("div",me,[o(i,{class:"is-loading"},{default:l(()=>[o(y(oe))]),_:1}),e[4]||(e[4]=s("p",null,"生成二维码中...",-1))])):f.value?(g(),C("div",fe,[s("img",{src:f.value.qr_code_url,alt:"谷歌验证码二维码"},null,8,ge),s("div",ve,[s("p",null,[e[5]||(e[5]=s("strong",null,"账户：",-1)),$(H(f.value.account_name),1)]),s("p",null,[e[6]||(e[6]=s("strong",null,"密钥：",-1)),$(H(f.value.secret),1)])])])):(g(),C("div",we,[o(i,null,{default:l(()=>[o(y(se))]),_:1}),e[8]||(e[8]=s("p",null,"生成二维码失败",-1)),o(k,{onClick:y(J),type:"primary"},{default:l(()=>[...e[7]||(e[7]=[$("重试",-1)])]),_:1},8,["onClick"])]))]),s("div",he,[o(k,{onClick:r,type:"primary",disabled:!f.value},{default:l(()=>[...e[9]||(e[9]=[$(" 下一步 ",-1)])]),_:1},8,["disabled"])])])):R("",!0),c.value===2?(g(),C("div",ye,[s("div",be,[o(i,{class:"step-icon"},{default:l(()=>[o(y(F))]),_:1}),e[10]||(e[10]=s("h3",null,"验证绑定",-1)),e[11]||(e[11]=s("p",null,"请输入谷歌验证器中的6位数字验证码",-1))]),o(D,{model:V,rules:E,ref_key:"bindFormRef",ref:m,"label-width":"0"},{default:l(()=>[o(u,{prop:"google_code"},{default:l(()=>[o(z,{modelValue:V.google_code,"onUpdate:modelValue":e[0]||(e[0]=P=>V.google_code=P),placeholder:"请输入6位验证码",maxlength:"6",size:"large",class:"verification-input"},{prefix:l(()=>[o(i,null,{default:l(()=>[o(y(j))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]),s("div",Ve,[o(k,{onClick:U},{default:l(()=>[...e[12]||(e[12]=[$("上一步",-1)])]),_:1}),o(k,{onClick:I,type:"primary",loading:p.value,disabled:!V.google_code},{default:l(()=>[...e[13]||(e[13]=[$(" 完成绑定 ",-1)])]),_:1},8,["loading","disabled"])])])):R("",!0),c.value===3?(g(),C("div",ke,[s("div",Ce,[o(i,{class:"success-icon"},{default:l(()=>[o(y(le))]),_:1}),e[15]||(e[15]=s("h3",null,"绑定成功",-1)),e[16]||(e[16]=s("p",null,"谷歌验证码已成功绑定到您的账户",-1)),o(k,{onClick:n,type:"primary",size:"large"},{default:l(()=>[...e[14]||(e[14]=[$(" 完成 ",-1)])]),_:1})])])):R("",!0)])]),_:1},8,["modelValue"])}}}),Ae=Z(xe,[["__scopeId","data-v-476542ff"]]),$e={class:"dialog-footer"},qe=K({__name:"ChangePasswordDialog",emits:["success","close"],setup(q,{expose:v,emit:w}){const S=w,_=t(!1),c=t(!1),h=t(0),p=O({new_password:"",confirm_password:""}),x=t(),f={new_password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:8,message:"密码长度至少8位",trigger:"blur"},{validator:(m,a,r)=>{a&&a.length<8?r(new Error("密码长度至少8位")):a&&!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^a-zA-Z\d])/.test(a)?r(new Error("密码必须包含大小写字母、数字、特殊字符")):r()},trigger:"blur"}],confirm_password:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(m,a,r)=>{a!==p.new_password?r(new Error("两次输入的密码不一致")):r()},trigger:"blur"}]},V=m=>{_.value=!0,h.value=m,p.new_password="",p.confirm_password=""},E=async()=>{var m,a;try{await((m=x.value)==null?void 0:m.validate()),c.value=!0;const r=await G.post("/api/v1/admin/change-password",{admin_id:h.value,new_password:p.new_password,confirm_password:p.confirm_password});console.log("密码修改API响应:",r),r.code===200&&(b.success("密码修改成功，请重新登录"),_.value=!1,S("success"))}catch(r){console.error("密码修改失败:",r),console.error("错误详情:",(a=r.response)==null?void 0:a.data)}finally{c.value=!1}};return v({open:V}),(m,a)=>{const r=ee,U=Q,B=T,I=M,n=N,d=Y;return g(),W(d,{modelValue:_.value,"onUpdate:modelValue":a[3]||(a[3]=e=>_.value=e),title:"修改密码",width:"500px","close-on-click-modal":!1,"show-close":!1,"close-on-press-escape":!1,"destroy-on-close":""},{footer:l(()=>[s("div",$e,[o(n,{onClick:E,type:"primary",loading:c.value},{default:l(()=>[...a[4]||(a[4]=[$(" 确认修改 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[o(r,{title:"首次登录需要修改密码",type:"warning",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}}),o(I,{ref_key:"formRef",ref:x,model:p,rules:f,"label-width":"120px",onSubmit:a[2]||(a[2]=ae(()=>{},["prevent"]))},{default:l(()=>[o(B,{label:"新密码",prop:"new_password"},{default:l(()=>[o(U,{modelValue:p.new_password,"onUpdate:modelValue":a[0]||(a[0]=e=>p.new_password=e),type:"password",placeholder:"请输入新密码","show-password":"",clearable:"",onKeyup:L(E,["enter"])},null,8,["modelValue"])]),_:1}),o(B,{label:"确认密码",prop:"confirm_password"},{default:l(()=>[o(U,{modelValue:p.confirm_password,"onUpdate:modelValue":a[1]||(a[1]=e=>p.confirm_password=e),type:"password",placeholder:"请再次输入新密码","show-password":"",clearable:"",onKeyup:L(E,["enter"])},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),Ee=Z(qe,[["__scopeId","data-v-8ea8ed6c"]]),Ie="/assets/login-header-C_4yz5CA.png",Se={class:"login-container"},Ue={class:"login-content"},Be={class:"login-card"},ze={class:"login-header"},De={class:"logo-container"},Re=["src"],Ge={class:"login-form-container"},Pe={class:"form-item"},Fe={class:"form-item"},Le={key:0,class:"form-item google-auth-input"},Ke={class:"form-options"},Ne={class:"form-submit"},Me={key:0},Te={key:1},Qe=K({__name:"Login",setup(q){const v=t(""),w=t(""),S=t(!1),_=t(""),c=t(!1),h=t(!1),p=t(),x=t(!1),f=t(null),V=t(),E=t(!1),m=t(null),a=t({username:"",password:"",googleAuthCode:"",rememberMe:!1}),r=async()=>{var I,n,d,e,i,k,z;if(!v.value||!w.value){b.error("请输入账号和密码");return}try{h.value=!0;const u=await de({username:v.value,password:w.value,google_code:c.value?_.value:""});if((I=u.data)!=null&&I.need_change_password){E.value=!0,m.value=u.data,(n=V.value)==null||n.open(u.data.admin_id);return}if((d=u.data)!=null&&d.need_bind_google){x.value=!0,f.value=u.data,(e=p.value)==null||e.open(u.data.admin_id,u.data.username);return}(i=u.data)!=null&&i.status||(k=u.data)!=null&&k.Authorization?(b.success("登录成功"),setTimeout(()=>{window.location.href="/dashboard"},1e3)):b.error(((z=u.data)==null?void 0:z.message)||"登录失败")}catch(u){u.message&&u.message.includes("请输入谷歌验证码")&&(c.value=!0,setTimeout(()=>{const D=document.querySelector(".google-auth-input .el-input__inner");D&&D.focus()},100)),console.error("登录错误:",u)}finally{h.value=!1}},U=()=>{x.value=!1,f.value=null,b.success("谷歌验证码绑定成功，页面将自动刷新，请重新登录"),v.value="",w.value="",_.value=""},B=()=>{E.value=!1,m.value=null,b.success("密码修改成功，请重新登录"),v.value="",w.value="",_.value=""};return(I,n)=>{const d=X,e=Q,i=T,k=ee,z=re,u=N,D=M;return g(),C("div",Se,[n[7]||(n[7]=te('<div class="background-decoration" data-v-955c9273><div class="floating-shapes" data-v-955c9273><div class="shape shape-1" data-v-955c9273></div><div class="shape shape-2" data-v-955c9273></div><div class="shape shape-3" data-v-955c9273></div><div class="shape shape-4" data-v-955c9273></div></div></div>',1)),s("div",Ue,[s("div",Be,[s("div",ze,[s("div",De,[s("img",{src:y(Ie),alt:"系统Logo",class:"logo"},null,8,Re)]),n[4]||(n[4]=s("h1",{class:"welcome-title"},"欢迎登录",-1)),n[5]||(n[5]=s("p",{class:"welcome-subtitle"},"百亿四方支付管理系统",-1))]),s("div",Ge,[o(D,{model:a.value,class:"login-form","label-position":"top",size:"large"},{default:l(()=>[s("div",Pe,[o(i,null,{default:l(()=>[o(e,{modelValue:v.value,"onUpdate:modelValue":n[0]||(n[0]=A=>v.value=A),placeholder:"请输入登录账号",class:"custom-input",clearable:""},{prefix:l(()=>[o(d,{class:"input-icon"},{default:l(()=>[o(y(ne))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),s("div",Fe,[o(i,null,{default:l(()=>[o(e,{modelValue:w.value,"onUpdate:modelValue":n[1]||(n[1]=A=>w.value=A),type:"password",placeholder:"请输入登录密码",class:"custom-input","show-password":"",clearable:""},{prefix:l(()=>[o(d,{class:"input-icon"},{default:l(()=>[o(y(F))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),c.value?(g(),C("div",Le,[o(k,{title:"请输入谷歌验证码",type:"info",closable:!1,"show-icon":"",class:"google-auth-alert"}),o(i,null,{default:l(()=>[o(e,{modelValue:_.value,"onUpdate:modelValue":n[2]||(n[2]=A=>_.value=A),placeholder:"请输入6位验证码",class:"custom-input",clearable:"",maxlength:"6",onKeyup:L(r,["enter"])},{prefix:l(()=>[o(d,{class:"input-icon"},{default:l(()=>[o(y(F))]),_:1})]),_:1},8,["modelValue"])]),_:1})])):R("",!0),s("div",Ke,[o(z,{modelValue:S.value,"onUpdate:modelValue":n[3]||(n[3]=A=>S.value=A),class:"remember-checkbox"},{default:l(()=>[...n[6]||(n[6]=[$(" 保持会话 ",-1)])]),_:1},8,["modelValue"])]),s("div",Ne,[o(u,{type:"primary",size:"large",class:"login-button",onClick:r,disabled:!v.value||!w.value,loading:h.value},{default:l(()=>[h.value?(g(),C("span",Te,"登录中...")):(g(),C("span",Me,"登录账号"))]),_:1},8,["disabled","loading"])])]),_:1},8,["model"])])])]),o(Ae,{ref_key:"googleAuthBindRef",ref:p,onSuccess:U},null,512),o(Ee,{ref_key:"changePasswordRef",ref:V,onSuccess:B},null,512)])}}}),Je=Z(Qe,[["__scopeId","data-v-955c9273"]]);export{Je as default};
//# sourceMappingURL=Login-D-1pXc7L.js.map
