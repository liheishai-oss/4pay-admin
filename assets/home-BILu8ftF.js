const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/detail-CKpFf2rm.js","assets/index-DQjW5cRd.js","assets/index-BDOPLeYz.css","assets/orderManagement-C0-WVVZO.js","assets/detail-CoVh6DoR.css","assets/loading-oV0W9nDj.css","assets/empty-iVBaPuAw.css","assets/table-column-DHEyVPoW.css","assets/checkbox-CXazyT-T.css","assets/tag-CtW1DIiB.css"])))=>i.map(i=>d[i]);
import{d as me,h as B,y as pe,c as _e,a,e as p,u as o,w as t,T as fe,C as _,a0 as ge,M as y,F as he,j as ve,z as be,A as ye,B as we,aG as xe,o as h,at as Ce,a5 as ke,i as Te,E as Ve,b as Se,D as Ee,l as Re,ap as De,ar as Be,aH as $e,v as c,m as qe,J as $,H as U,ag as Me,G as ze,K as Fe,Y as E,X as Pe,k as q,au as I,aC as Ue,x as i,aS as k,s as T,g as Ie}from"./index-DQjW5cRd.js";/* empty css                   *//* empty css            *//* empty css               *//* empty css              *//* empty css                     *//* empty css                 *//* empty css             *//* empty css             *//* empty css                          */import"./form-item-l0sNRNKZ.js";import{u as Ye}from"./table.plugin-DtcfBVC9.js";const He={class:"table-com-search"},Ne={class:"search-header"},Oe={class:"search-title"},Ae={class:"search-buttons"},Le={class:"table-header ba-scroll-style"},Ge={class:"table-search"},je={style:{width:"100%","overflow-x":"auto"},class:"table-content"},Je={class:"table-footer"},Ke={class:"table-pagination"},Qe=me({__name:"home",setup(Xe){const Y=Ce(()=>I(()=>import("./detail-CKpFf2rm.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),R=B(null),H=(s={})=>{console.log(s),Ue(()=>{R.value?R.value.open({...s}):console.error("DetailForm 组件未正确挂载！")})},{handleSelectionChange:N,hasSelectedRows:V,isVisible:O,toggleVisibility:M,loadData:A,data:f,refreshData:m,handleSizeChange:L,handleCurrentChange:G,searchParams:w}=Ye("/api/v1/admin/order");w.value.search||(w.value.search={});const j=()=>{w.value.search||(w.value.search={order_no:"",merchant_order_no:"",merchant_id:"",status:"",product_name:"",start_time:"",end_time:""})},d=B({order_no:"",merchant_order_no:"",merchant_id:"",status:"",product_name:"",timeRange:null}),D=B(!1),J=async()=>{D.value=!0;try{let s={...d.value};s.timeRange&&s.timeRange.length===2&&(s.start_time=s.timeRange[0],s.end_time=s.timeRange[1]),delete s.timeRange,delete s.quickTime,w.value.search=s,await m()}catch(s){console.error("搜索失败:",s),i.error("搜索失败，请重试")}finally{D.value=!1}},K=()=>{d.value={order_no:"",merchant_order_no:"",merchant_id:"",status:"",product_name:"",timeRange:null},w.value.search={...d.value},m()};pe(()=>{j(),A()});const z=s=>({1:"待支付",2:"支付中",3:"支付成功",4:"支付失败",5:"已退款",6:"已关闭"})[s]||"未知状态",Q=s=>({1:"warning",2:"primary",3:"success",4:"danger",5:"info",6:"info"})[s]||"info",X=s=>({0:"未通知",1:"通知成功",2:"通知失败"})[s]||"未知状态",W=s=>({0:"warning",1:"success",2:"danger"})[s]||"info",Z=async s=>{try{await k.confirm(`确定要退款订单 ${s.order_no} 吗？`,"确认退款",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const{refundOrder:e}=await I(async()=>{const{refundOrder:l}=await import("./orderManagement-C0-WVVZO.js");return{refundOrder:l}},__vite__mapDeps([3,1,2])),r=await e("/api/v1/admin/order/refund",{order_id:s.id,reason:"管理员退款"});r.status?(i.success("退款申请已提交"),m()):i.error(r.message)}catch(e){e!=="cancel"&&i.error("退款申请失败")}},ee=async s=>{try{await k.confirm(`确定要补单 ${s.order_no} 吗？`,"确认补单",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await T.post("/api/v1/admin/order/reissue",{ids:[s.id]});e.code===200?(i.success("补单成功"),m()):i.error(e.msg)}catch{i.error("补单失败")}},ae=async s=>{try{await k.confirm(`确定要重新回调 ${s.order_no} 吗？`,"确认回调",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await T.post("/api/v1/admin/order/callback",{ids:[s.id]});e.code===200?(i.success("回调成功"),m()):i.error(e.msg)}catch{i.error("回调失败")}},te=async()=>{var s;if(!V.value){i.warning("请选择要补单的订单");return}try{await k.confirm("确定要批量补单选中的订单吗？","确认批量补单",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await T.post("/api/v1/admin/order/reissue",{ids:((s=f.value.selectedRows)==null?void 0:s.map(r=>r.id))||[]});e.code===200?(i.success("批量补单成功"),m()):i.error(e.msg)}catch{i.error("批量补单失败")}},se=async()=>{var s;if(!V.value){i.warning("请选择要回调的订单");return}try{await k.confirm("确定要批量回调选中的订单吗？","确认批量回调",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await T.post("/api/v1/admin/order/callback",{ids:((s=f.value.selectedRows)==null?void 0:s.map(r=>r.id))||[]});e.code===200?(i.success("批量回调成功"),m()):i.error(e.msg)}catch{i.error("批量回调失败")}},le=async s=>{try{const e=await T.post("/api/v1/admin/order/query",{order_no:s.order_no});if(e.code===200){const r=e.data;let l=`📋 订单信息
`;l+=`═══════════════════════════════════════════════════════════
`,l+=`🔢 订单号：${r.order_no}
`,l+=`📊 当前状态：${z(r.status)}
`,l+=`💰 订单金额：¥${(r.amount/100).toFixed(2)}
`,l+=`📅 创建时间：${new Date(r.created_at).toLocaleString()}

`,l+=`🔍 支付通道查询结果
`,l+=`───────────────────────────────────────────────────────────
`,r.query_success?(l+=`✅ 查询状态：成功
`,r.query_result&&r.query_result.unified_status_text?l+=`📊 当前状态：${r.query_result.unified_status_text}
`:l+=`📊 当前状态：${r.query_message}
`,r.query_result&&r.query_result.unified_status_text&&(l+=`
📋 状态详情：
`,l+=`───────────────────────────────────────────────────────────
`,l+=`🎯 统一状态：${r.query_result.unified_status_text}
`,l+=`📝 原始状态：${r.query_result.original_status||"未知"}
`,l+=`📊 状态字段：${r.query_result.original_status_field||"status"}
`,l+=`🏢 供货商类型：${r.query_result.supplier_type||"未知"}
`),r.query_result&&Object.keys(r.query_result).length>0||(l+=`
📄 通道返回数据：无数据
`)):(l+=`❌ 查询状态：失败
`,l+=`⚠️  错误信息：${r.query_message}
`),l+=`
═══════════════════════════════════════════════════════════`;const x=l.replace(/\n/g,"<br>").replace(/`([^`]+)`/g,"<code>$1</code>");k.alert(x,"🔍 查单结果",{confirmButtonText:"确定",type:r.query_success?"success":"warning",dangerouslyUseHTMLString:!0,customStyle:{"max-width":"900px","max-height":"700px",overflow:"auto","font-family":"monospace","line-height":"1.6","white-space":"pre-wrap","word-break":"break-all"}})}else console.error("查单API返回错误：",e),i.error(e.msg||"查单失败")}catch(e){console.error("查单请求异常：",e),i.error("查单失败："+(e.message||"网络错误"))}};return(s,e)=>{const r=qe,l=ve,x=Re,v=Ee,b=Se,C=Be,ne=De,F=Ve,re=$e,oe=Te,ie=ke,de=be,u=Fe,P=Pe,ue=ye,ce=we,g=xe("permission");return h(),_e(he,null,[a(o(Y),{ref_key:"detailFormRef",ref:R,onRefresh:o(m)},null,8,["onRefresh"]),a(fe,{name:"fade"},{default:t(()=>[_(p("div",He,[a(ie,{class:"search-card",shadow:"never"},{header:t(()=>[p("div",Ne,[p("span",Oe,[a(r,null,{default:t(()=>[a(o($))]),_:1}),e[8]||(e[8]=c(" 订单搜索 ",-1))]),a(l,{type:"text",onClick:o(M),class:"close-btn"},{default:t(()=>[a(r,null,{default:t(()=>[a(o(Me))]),_:1})]),_:1},8,["onClick"])])]),default:t(()=>[a(oe,{model:d.value,"label-width":"100px",class:"search-form"},{default:t(()=>[a(F,{gutter:20},{default:t(()=>[a(b,{span:6},{default:t(()=>[a(v,{label:"订单号"},{default:t(()=>[a(x,{modelValue:d.value.order_no,"onUpdate:modelValue":e[0]||(e[0]=n=>d.value.order_no=n),placeholder:"请输入订单号",clearable:"","prefix-icon":"Search"},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{span:6},{default:t(()=>[a(v,{label:"商户订单号"},{default:t(()=>[a(x,{modelValue:d.value.merchant_order_no,"onUpdate:modelValue":e[1]||(e[1]=n=>d.value.merchant_order_no=n),placeholder:"请输入商户订单号",clearable:"","prefix-icon":"Search"},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{span:6},{default:t(()=>[a(v,{label:"商户ID"},{default:t(()=>[a(x,{modelValue:d.value.merchant_id,"onUpdate:modelValue":e[2]||(e[2]=n=>d.value.merchant_id=n),placeholder:"请输入商户ID",clearable:"","prefix-icon":"User"},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{span:6},{default:t(()=>[a(v,{label:"订单状态"},{default:t(()=>[a(ne,{modelValue:d.value.status,"onUpdate:modelValue":e[3]||(e[3]=n=>d.value.status=n),placeholder:"请选择订单状态",clearable:"",style:{width:"100%"}},{default:t(()=>[a(C,{label:"待支付",value:1}),a(C,{label:"支付中",value:2}),a(C,{label:"支付成功",value:3}),a(C,{label:"支付失败",value:4}),a(C,{label:"已退款",value:5}),a(C,{label:"已关闭",value:6})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(F,{gutter:20},{default:t(()=>[a(b,{span:6},{default:t(()=>[a(v,{label:"支付产品"},{default:t(()=>[a(x,{modelValue:d.value.product_name,"onUpdate:modelValue":e[4]||(e[4]=n=>d.value.product_name=n),placeholder:"请输入产品名称",clearable:"","prefix-icon":"Goods"},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{span:6},{default:t(()=>[a(v,{label:"时间范围"},{default:t(()=>[a(re,{modelValue:d.value.timeRange,"onUpdate:modelValue":e[5]||(e[5]=n=>d.value.timeRange=n),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{span:6},{default:t(()=>[a(v,null,{default:t(()=>[p("div",Ae,[a(l,{type:"primary",onClick:J,loading:D.value},{default:t(()=>[a(r,null,{default:t(()=>[a(o($))]),_:1}),e[9]||(e[9]=c(" 搜索 ",-1))]),_:1},8,["loading"]),a(l,{onClick:K},{default:t(()=>[a(r,null,{default:t(()=>[a(o(U))]),_:1}),e[10]||(e[10]=c(" 重置 ",-1))]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[ze,o(O)]])]),_:1}),p("div",Le,[_(a(l,{icon:o(U),onClick:o(m),color:"#40485b"},null,8,["icon","onClick"]),[[g,"order:list"]]),_((h(),y(l,{type:"primary",disabled:!o(V),onClick:te},{default:t(()=>[...e[11]||(e[11]=[c("补单",-1)])]),_:1},8,["disabled"])),[[g,"order:resend"]]),_((h(),y(l,{type:"primary",disabled:!o(V),onClick:se},{default:t(()=>[...e[12]||(e[12]=[c("回调",-1)])]),_:1},8,["disabled"])),[[g,"order:callback"]]),e[13]||(e[13]=ge('<div class="table-statistics" data-v-21ad3e16><span class="stat-item stat-highlight" data-v-21ad3e16>累计订单数: <b class="stat-number" data-v-21ad3e16>150</b></span><span class="stat-item stat-highlight" data-v-21ad3e16>订单总金额: <b class="stat-number" data-v-21ad3e16>￥8000.00</b></span><span class="stat-item stat-success" data-v-21ad3e16>已付订单数: <b class="stat-number" data-v-21ad3e16>100</b></span><span class="stat-item stat-success" data-v-21ad3e16>已付总金额: <b class="stat-number" data-v-21ad3e16>￥6000.00</b></span><span class="stat-item stat-info" data-v-21ad3e16>商户总收入: <b class="stat-number" data-v-21ad3e16>￥5976.00</b></span><span class="stat-item stat-warning" data-v-21ad3e16>未付订单数: <b class="stat-number" data-v-21ad3e16>50</b></span><span class="stat-item stat-warning" data-v-21ad3e16>未付总金额: <b class="stat-number" data-v-21ad3e16>￥2000.00</b></span><span class="stat-item stat-success" data-v-21ad3e16>成功率: <b class="stat-number" data-v-21ad3e16>66.67%</b></span></div>',1)),p("div",Ge,[a(de,{class:"ml-4"},{default:t(()=>[a(l,{icon:o($),onClick:o(M)},null,8,["icon","onClick"])]),_:1})])]),p("div",je,[a(ue,{data:o(f).data,border:"",stripe:"","max-height":"600",style:{width:"100%"},onSelectionChange:o(N)},{default:t(()=>[a(u,{type:"selection",width:"40"}),a(u,{prop:"order_no",label:"平台单号",align:"center","min-width":"200"}),a(u,{prop:"merchant_order_no",label:"商户订单号",align:"center","min-width":"167"}),a(u,{prop:"merchant.merchant_name",label:"商户名称",align:"center","min-width":"150"}),a(u,{prop:"amount",label:"金额",align:"center","min-width":"80"},{default:t(({row:n})=>[c(E((n.amount/100).toFixed(2)),1)]),_:1}),a(u,{label:"订单状态",align:"center","min-width":"200"},{default:t(()=>[a(u,{label:"状态",width:"100",align:"center"},{default:t(({row:n})=>[a(P,{type:Q(n.status)},{default:t(()=>[c(E(z(n.status)),1)]),_:2},1032,["type"])]),_:1}),a(u,{prop:"paid_time",label:"支付时间",width:"100",align:"center"})]),_:1}),a(u,{prop:"product.product_name",label:"支付产品",align:"center","min-width":"120"}),a(u,{prop:"channel.channel_name",label:"支付通道",align:"center","min-width":"120"}),a(u,{prop:"fee",label:"费用",align:"center","min-width":"80"},{default:t(({row:n})=>[c(E((n.fee/100).toFixed(2)),1)]),_:1}),a(u,{prop:"notify_status",label:"通知状态",align:"center","min-width":"100"},{default:t(({row:n})=>[a(P,{type:W(n.notify_status),size:"small"},{default:t(()=>[c(E(X(n.notify_status)),1)]),_:2},1032,["type"])]),_:1}),a(u,{prop:"created_at",label:"创建时间",align:"center","min-width":"180"}),a(u,{label:"操作",align:"center",fixed:"right","min-width":"250"},{default:t(n=>[_((h(),y(l,{size:"small",onClick:S=>H(n.row)},{default:t(()=>[...e[14]||(e[14]=[c("订单详情",-1)])]),_:1},8,["onClick"])),[[g,"order:detail"]]),_((h(),y(l,{size:"small",type:"info",onClick:S=>le(n.row)},{default:t(()=>[...e[15]||(e[15]=[c("查单",-1)])]),_:1},8,["onClick"])),[[g,"order:query"]]),n.row.status===3?_((h(),y(l,{key:0,size:"small",type:"warning",onClick:S=>Z(n.row)},{default:t(()=>[...e[16]||(e[16]=[c("退款",-1)])]),_:1},8,["onClick"])),[[g,"order:refund"]]):q("",!0),[4,6].includes(n.row.status)?_((h(),y(l,{key:1,size:"small",type:"primary",onClick:S=>ee(n.row)},{default:t(()=>[...e[17]||(e[17]=[c("补单",-1)])]),_:1},8,["onClick"])),[[g,"order:resend"]]):q("",!0),n.row.status===3?_((h(),y(l,{key:2,size:"small",type:"success",onClick:S=>ae(n.row)},{default:t(()=>[...e[18]||(e[18]=[c("回调",-1)])]),_:1},8,["onClick"])),[[g,"order:callback"]]):q("",!0)]),_:1})]),_:1},8,["data","onSelectionChange"])]),p("div",Je,[p("div",Ke,[a(ce,{"current-page":o(f).current_page,"onUpdate:currentPage":e[6]||(e[6]=n=>o(f).current_page=n),"page-size":o(f).page_size,"onUpdate:pageSize":e[7]||(e[7]=n=>o(f).page_size=n),"page-sizes":[10,50,100,200],background:!0,"prev-text":"上一页","next-text":"下一页",layout:"total, sizes, prev, pager, next, jumper",total:o(f).page_total,onSizeChange:o(L),onCurrentChange:o(G)},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])],64)}}}),ua=Ie(Qe,[["__scopeId","data-v-21ad3e16"]]);export{ua as default};
//# sourceMappingURL=home-BILu8ftF.js.map
