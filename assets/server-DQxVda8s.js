import{s as P,_ as Pe,g as f,h as M,L as Te,c as J,e as s,a as l,w as a,u as k,T as Be,Q as ae,au as Le,i as Q,D as r,q as ze,N as Me,O as Fe,P as Ne,C as Re,o as D,n as o,k as je,S as te,U as ne,aJ as Oe,V as se,a1 as qe,x as Ae,E as Ge,b as We,y as Je,z as Qe,ar as Xe,at as He,ai as Ke,R as Ye,W as Ze,aT as el,t as b,a8 as ll,X as al,j as oe,a3 as tl,aU as nl,aV as sl,aa as ol,ab as rl,M as il,as as dl,aS as re}from"./index-BvjDfs_Q.js";/* empty css                *//* empty css                    *//* empty css                     *//* empty css                   *//* empty css               *//* empty css                     *//* empty css                 */const ul=(_={})=>P({url:"/api/v1/admin/test/server-list",method:"get",params:_}),pl=_=>P({url:"/api/v1/admin/server/add",method:"post",data:_}),ml=(_,h)=>P({url:`/api/v1/admin/server/update/${_}`,method:"post",data:h}),ie=_=>P({url:`/api/v1/admin/server/delete/${_}`,method:"delete"}),cl=(_,h)=>P({url:`/api/v1/admin/server/toggle-maintenance/${_}`,method:"post",data:{is_maintenance:h}}),_l=_=>P({url:"/api/v1/admin/server/deploy",method:"post",data:_}),vl={class:"server-management-page"},fl={class:"page-header"},gl={class:"header-actions"},bl={class:"table-header ba-scroll-style"},yl={class:"table-search"},Vl={class:"search-header"},hl={class:"search-title"},wl={class:"search-buttons"},kl={style:{width:"100%","overflow-x":"auto"},class:"table-content"},Cl={class:"metric-item"},Sl={class:"metric-value"},xl={class:"metric-item"},El={class:"metric-value"},Ul={class:"metric-item"},$l={class:"metric-value"},Il={class:"pagination-container"},Dl={key:0,class:"server-detail"},Pl={class:"metrics-chart"},Tl={class:"chart-container"},Bl={class:"metric-chart"},Ll={class:"metric-chart"},zl={class:"metric-chart"},Ml={class:"deploy-content"},Fl={class:"dialog-footer"},Nl={__name:"server",setup(_){const h=f(!1),F=f(!1),C=f(!1),N=f(!1),R=f(!1),T=f(!1),x=f(null),j=f(!1),d=f(null),w=f([]),L=f(!1),O=f([]),y=M({current_page:1,per_page:20,total:0}),u=M({server_name:"",server_ip:"",server_port:80,is_maintenance:!1,remark:""}),p=M({mode:"update_restart",serverIds:[],description:""}),g=M({server_name:"",server_ip:"",status:"",is_maintenance:null}),de={server_name:[{required:!0,message:"请输入服务器名称",trigger:"blur"}],server_ip:[{required:!0,message:"请输入服务器IP",trigger:"blur"},{pattern:/^(\d{1,3}\.){3}\d{1,3}$/,message:"请输入正确的IP地址",trigger:"blur"}]},V=async()=>{h.value=!0;try{const n={page:y.current_page,per_page:y.per_page,...g},e=await ul(n);e.code===200?(O.value=e.data.data.map(m=>({...m,maintenanceLoading:!1})),y.total=e.data.total):r.error(`获取服务器列表失败: ${e.message}`)}catch(n){r.error("获取服务器列表失败"),console.error("获取服务器列表失败:",n)}finally{h.value=!1}},ue=async n=>{n.maintenanceLoading=!0;try{const e=await cl(n.id,n.is_maintenance);e.code===200?r.success(`服务器${n.is_maintenance?"已开启":"已关闭"}维护模式`):(r.error(`操作失败: ${e.message}`),n.is_maintenance=!n.is_maintenance)}catch{r.error("操作失败"),n.is_maintenance=!n.is_maintenance}finally{n.maintenanceLoading=!1}},X=n=>{x.value=n,Object.assign(u,{server_name:n.server_name,server_ip:n.server_ip,server_port:n.server_port,is_maintenance:n.is_maintenance,remark:n.remark}),C.value=!0},pe=n=>{d.value=n,N.value=!0},me=async n=>{try{await re.confirm(`确定要删除服务器 "${n.server_name}" 吗？`,"确认删除",{type:"warning",confirmButtonText:"确定删除",cancelButtonText:"取消"});const e=await ie(n.id);e.code===200?(r.success("服务器删除成功"),V()):r.error(`删除失败: ${e.message}`)}catch(e){e!=="cancel"&&(r.error("删除服务器失败"),console.error("删除服务器失败:",e))}},ce=async()=>{try{F.value=!0;let n;if(x.value)if(n=await ml(x.value.id,u),n.code===200)r.success("服务器更新成功");else{r.error(`更新失败: ${n.message}`);return}else if(n=await pl(u),n.code===200)r.success("服务器添加成功");else{r.error(`添加失败: ${n.message}`);return}C.value=!1,H(),V()}catch{r.error("保存失败")}finally{F.value=!1}},H=()=>{x.value=null,Object.assign(u,{server_name:"",server_ip:"",server_port:80,is_maintenance:!1,remark:""})},_e=n=>{y.per_page=n,V()},ve=n=>{y.current_page=n,V()},K=n=>({online:"success",offline:"danger",maintenance:"warning"})[n]||"info",Y=n=>({online:"在线",offline:"离线",maintenance:"维护中"})[n]||"未知",E=n=>n>=80?"#f56c6c":n>=60?"#e6a23c":"#67c23a",fe=n=>n?new Date(n).toLocaleString():"N/A",Z=()=>{R.value=!R.value},ge=()=>{V()},be=()=>{Object.assign(g,{server_name:"",server_ip:"",status:"",is_maintenance:null}),V()},ye=n=>{w.value=n,L.value=n.length>0},Ve=()=>{if(w.value.length===0){r.warning("请选择要编辑的服务器");return}if(w.value.length>1){r.warning("只能选择一个服务器进行编辑");return}X(w.value[0])},he=()=>{if(w.value.length===0){r.warning("请选择要删除的服务器");return}const n=w.value.filter(m=>m.status==="offline");if(w.value.filter(m=>m.status!=="offline").length>0){r.warning("只能删除离线状态的服务器，请取消选择在线服务器");return}re.confirm(`确定要删除选中的 ${n.length} 个离线服务器吗？`,"确认删除",{type:"warning",confirmButtonText:"确定删除",cancelButtonText:"取消"}).then(async()=>{try{const m=n.map(i=>ie(i.id));await Promise.all(m),w.value=[],L.value=!1,r.success("批量删除成功"),V()}catch(m){r.error("批量删除失败"),console.error("批量删除失败:",m)}}).catch(()=>{})},we=async()=>{if(p.serverIds.length===0){r.warning("请选择要部署的服务器");return}if(!p.description.trim()){r.warning("请输入部署说明");return}try{j.value=!0;const n=await _l({mode:p.mode,server_ids:p.serverIds,description:p.description});n.code===200?(r.success("部署任务已提交，请查看部署日志"),T.value=!1,p.serverIds=[],p.description="",p.mode="update_restart"):r.error(`部署失败: ${n.message}`)}catch(n){r.error("部署失败"),console.error("部署失败:",n)}finally{j.value=!1}};return Te(()=>{V()}),(n,e)=>{const m=je,i=ze,ke=Me,U=Qe,v=Je,z=We,$=He,q=Xe,Ce=Ge,A=Ae,Se=qe,c=Ze,I=el,ee=ll,G=al,xe=Fe,Ee=Ne,Ue=tl,W=Re,S=sl,$e=nl,le=rl,Ie=ol,De=Le;return D(),J("div",vl,[s("div",fl,[e[25]||(e[25]=s("div",{class:"header-left"},[s("h2",null,"服务器管理"),s("p",{class:"page-description"},"管理系统服务器状态和配置")],-1)),s("div",gl,[l(i,{onClick:V,loading:h.value,type:"primary"},{default:a(()=>[l(m,null,{default:a(()=>[l(k(te))]),_:1}),e[23]||(e[23]=o(" 刷新 ",-1))]),_:1},8,["loading"]),l(i,{onClick:e[0]||(e[0]=t=>C.value=!0),type:"success"},{default:a(()=>[l(m,null,{default:a(()=>[l(k(ne))]),_:1}),e[24]||(e[24]=o(" 添加服务器 ",-1))]),_:1})])]),s("div",bl,[l(i,{icon:k(te),onClick:V,color:"#40485b"},null,8,["icon"]),l(i,{type:"primary",icon:k(ne),onClick:e[1]||(e[1]=t=>C.value=!0)},{default:a(()=>[...e[26]||(e[26]=[o("添加",-1)])]),_:1},8,["icon"]),l(i,{type:"primary",disabled:!L.value,onClick:Ve},{default:a(()=>[...e[27]||(e[27]=[o("编辑",-1)])]),_:1},8,["disabled"]),l(i,{type:"danger",disabled:!L.value,onClick:he},{default:a(()=>[...e[28]||(e[28]=[o("删除",-1)])]),_:1},8,["disabled"]),l(i,{type:"success",icon:k(Oe),onClick:e[2]||(e[2]=t=>T.value=!0)},{default:a(()=>[...e[29]||(e[29]=[o("部署",-1)])]),_:1},8,["icon"]),s("div",yl,[l(ke,{class:"ml-4"},{default:a(()=>[l(i,{icon:k(se),onClick:Z},null,8,["icon"])]),_:1})])]),l(Be,{name:"fade"},{default:a(()=>[ae(l(Se,{class:"search-card"},{header:a(()=>[s("div",Vl,[s("div",hl,[l(m,null,{default:a(()=>[l(k(se))]),_:1}),e[30]||(e[30]=o(" 搜索条件 ",-1))]),l(i,{type:"text",onClick:Z,class:"close-btn"},{default:a(()=>[l(m,null,{default:a(()=>[l(k(Ke))]),_:1})]),_:1})])]),default:a(()=>[l(A,{model:g,class:"search-form"},{default:a(()=>[l(Ce,{gutter:20},{default:a(()=>[l(z,{span:6},{default:a(()=>[l(v,{label:"服务器名称"},{default:a(()=>[l(U,{modelValue:g.server_name,"onUpdate:modelValue":e[3]||(e[3]=t=>g.server_name=t),placeholder:"请输入服务器名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(z,{span:6},{default:a(()=>[l(v,{label:"服务器IP"},{default:a(()=>[l(U,{modelValue:g.server_ip,"onUpdate:modelValue":e[4]||(e[4]=t=>g.server_ip=t),placeholder:"请输入服务器IP",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(z,{span:6},{default:a(()=>[l(v,{label:"状态"},{default:a(()=>[l(q,{modelValue:g.status,"onUpdate:modelValue":e[5]||(e[5]=t=>g.status=t),placeholder:"请选择状态",clearable:""},{default:a(()=>[l($,{label:"在线",value:"online"}),l($,{label:"离线",value:"offline"}),l($,{label:"维护中",value:"maintenance"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(z,{span:6},{default:a(()=>[l(v,{label:"维护状态"},{default:a(()=>[l(q,{modelValue:g.is_maintenance,"onUpdate:modelValue":e[6]||(e[6]=t=>g.is_maintenance=t),placeholder:"请选择维护状态",clearable:""},{default:a(()=>[l($,{label:"正常",value:!1}),l($,{label:"维护中",value:!0})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),s("div",wl,[l(i,{type:"primary",onClick:ge},{default:a(()=>[...e[31]||(e[31]=[o("搜索",-1)])]),_:1}),l(i,{onClick:be},{default:a(()=>[...e[32]||(e[32]=[o("重置",-1)])]),_:1})])]),_:1},8,["model"])]),_:1},512),[[Ye,R.value]])]),_:1}),s("div",kl,[ae((D(),Q(xe,{data:O.value,border:"",stripe:"","table-layout":"fixed",style:{width:"100%"},"empty-text":"暂无服务器数据",onSelectionChange:ye},{default:a(()=>[l(c,{type:"selection",width:"40"}),l(c,{prop:"id",label:"ID",align:"center","min-width":"80"}),l(c,{prop:"server_name",label:"服务器名称",align:"center","min-width":"150"}),l(c,{prop:"server_ip",label:"服务器IP",align:"center","min-width":"120"}),l(c,{label:"系统指标",align:"center","min-width":"300"},{default:a(()=>[l(c,{label:"CPU使用率",width:"100",align:"center"},{default:a(({row:t})=>[s("div",Cl,[l(I,{percentage:t.cpu_usage||0,color:E(t.cpu_usage),"stroke-width":6,"show-text":!1},null,8,["percentage","color"]),s("span",Sl,b(t.cpu_usage||0)+"%",1)])]),_:1}),l(c,{label:"内存使用率",width:"100",align:"center"},{default:a(({row:t})=>[s("div",xl,[l(I,{percentage:t.memory_usage||0,color:E(t.memory_usage),"stroke-width":6,"show-text":!1},null,8,["percentage","color"]),s("span",El,b(t.memory_usage||0)+"%",1)])]),_:1}),l(c,{label:"磁盘使用率",width:"100",align:"center"},{default:a(({row:t})=>[s("div",Ul,[l(I,{percentage:t.disk_usage||0,color:E(t.disk_usage),"stroke-width":6,"show-text":!1},null,8,["percentage","color"]),s("span",$l,b(t.disk_usage||0)+"%",1)])]),_:1})]),_:1}),l(c,{label:"状态",align:"center","min-width":"100"},{default:a(({row:t})=>[l(ee,{type:K(t.status),size:"small"},{default:a(()=>[o(b(Y(t.status)),1)]),_:2},1032,["type"])]),_:1}),l(c,{label:"维护状态",align:"center","min-width":"100"},{default:a(({row:t})=>[l(G,{modelValue:t.is_maintenance,"onUpdate:modelValue":B=>t.is_maintenance=B,onChange:B=>ue(t),loading:t.maintenanceLoading},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])]),_:1}),l(c,{prop:"remark",label:"备注",align:"center","min-width":"150","show-overflow-tooltip":""}),l(c,{prop:"created_at",label:"创建时间",align:"center","min-width":"160"}),l(c,{label:"操作",align:"center",fixed:"right","min-width":"200"},{default:a(({row:t})=>[l(i,{onClick:B=>X(t),type:"primary",size:"small"},{default:a(()=>[...e[33]||(e[33]=[o(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(i,{onClick:B=>pe(t),type:"info",size:"small"},{default:a(()=>[...e[34]||(e[34]=[o(" 详情 ",-1)])]),_:1},8,["onClick"]),t.status==="offline"?(D(),Q(i,{key:0,onClick:B=>me(t),type:"danger",size:"small"},{default:a(()=>[...e[35]||(e[35]=[o(" 删除 ",-1)])]),_:1},8,["onClick"])):oe("",!0)]),_:1})]),_:1},8,["data"])),[[De,h.value]]),s("div",Il,[l(Ee,{"current-page":y.current_page,"onUpdate:currentPage":e[7]||(e[7]=t=>y.current_page=t),"page-size":y.per_page,"onUpdate:pageSize":e[8]||(e[8]=t=>y.per_page=t),"page-sizes":[10,20,50,100],total:y.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:_e,onCurrentChange:ve},null,8,["current-page","page-size","total"])])]),l(W,{modelValue:C.value,"onUpdate:modelValue":e[15]||(e[15]=t=>C.value=t),title:x.value?"编辑服务器":"添加服务器",width:"600px",onClose:H},{footer:a(()=>[l(i,{onClick:e[14]||(e[14]=t=>C.value=!1)},{default:a(()=>[...e[36]||(e[36]=[o("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:ce,loading:F.value},{default:a(()=>[o(b(x.value?"更新":"添加"),1)]),_:1},8,["loading"])]),default:a(()=>[l(A,{ref:"serverFormRef",model:u,rules:de,"label-width":"100px"},{default:a(()=>[l(v,{label:"服务器名称",prop:"server_name"},{default:a(()=>[l(U,{modelValue:u.server_name,"onUpdate:modelValue":e[9]||(e[9]=t=>u.server_name=t),placeholder:"请输入服务器名称"},null,8,["modelValue"])]),_:1}),l(v,{label:"服务器IP",prop:"server_ip"},{default:a(()=>[l(U,{modelValue:u.server_ip,"onUpdate:modelValue":e[10]||(e[10]=t=>u.server_ip=t),placeholder:"请输入服务器IP地址"},null,8,["modelValue"])]),_:1}),l(v,{label:"服务器端口",prop:"server_port"},{default:a(()=>[l(Ue,{modelValue:u.server_port,"onUpdate:modelValue":e[11]||(e[11]=t=>u.server_port=t),min:1,max:65535,placeholder:"端口号"},null,8,["modelValue"])]),_:1}),l(v,{label:"维护状态"},{default:a(()=>[l(G,{modelValue:u.is_maintenance,"onUpdate:modelValue":e[12]||(e[12]=t=>u.is_maintenance=t)},null,8,["modelValue"])]),_:1}),l(v,{label:"备注",prop:"remark"},{default:a(()=>[l(U,{modelValue:u.remark,"onUpdate:modelValue":e[13]||(e[13]=t=>u.remark=t),type:"textarea",rows:3,placeholder:"请输入备注信息",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(W,{modelValue:N.value,"onUpdate:modelValue":e[17]||(e[17]=t=>N.value=t),title:"服务器详情",width:"800px"},{default:a(()=>[d.value?(D(),J("div",Dl,[l($e,{column:2,border:""},{default:a(()=>[l(S,{label:"服务器名称"},{default:a(()=>[o(b(d.value.server_name||"未命名"),1)]),_:1}),l(S,{label:"服务器IP"},{default:a(()=>[o(b(d.value.server_ip),1)]),_:1}),l(S,{label:"服务器端口"},{default:a(()=>[o(b(d.value.server_port||"N/A"),1)]),_:1}),l(S,{label:"状态"},{default:a(()=>[l(ee,{type:K(d.value.status)},{default:a(()=>[o(b(Y(d.value.status)),1)]),_:1},8,["type"])]),_:1}),l(S,{label:"维护状态"},{default:a(()=>[l(G,{modelValue:d.value.is_maintenance,"onUpdate:modelValue":e[16]||(e[16]=t=>d.value.is_maintenance=t),disabled:""},null,8,["modelValue"])]),_:1}),l(S,{label:"最后更新"},{default:a(()=>[o(b(fe(d.value.last_update)),1)]),_:1}),l(S,{label:"备注",span:2},{default:a(()=>[o(b(d.value.remark||"无备注"),1)]),_:1})]),_:1}),s("div",Pl,[e[40]||(e[40]=s("h4",null,"系统指标",-1)),s("div",Tl,[s("div",Bl,[e[37]||(e[37]=s("div",{class:"metric-label"},"CPU使用率",-1)),l(I,{percentage:d.value.cpu_usage||0,color:E(d.value.cpu_usage),"stroke-width":20},null,8,["percentage","color"])]),s("div",Ll,[e[38]||(e[38]=s("div",{class:"metric-label"},"内存使用率",-1)),l(I,{percentage:d.value.memory_usage||0,color:E(d.value.memory_usage),"stroke-width":20},null,8,["percentage","color"])]),s("div",zl,[e[39]||(e[39]=s("div",{class:"metric-label"},"磁盘使用率",-1)),l(I,{percentage:d.value.disk_usage||0,color:E(d.value.disk_usage),"stroke-width":20},null,8,["percentage","color"])])])])])):oe("",!0)]),_:1},8,["modelValue"]),l(W,{modelValue:T.value,"onUpdate:modelValue":e[22]||(e[22]=t=>T.value=t),title:"服务器部署",width:"600px","close-on-click-modal":!1},{footer:a(()=>[s("div",Fl,[l(i,{onClick:e[21]||(e[21]=t=>T.value=!1)},{default:a(()=>[...e[43]||(e[43]=[o("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:we,loading:j.value},{default:a(()=>[...e[44]||(e[44]=[o(" 开始部署 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[s("div",Ml,[l(A,{model:p,"label-width":"120px"},{default:a(()=>[l(v,{label:"部署模式"},{default:a(()=>[l(Ie,{modelValue:p.mode,"onUpdate:modelValue":e[18]||(e[18]=t=>p.mode=t)},{default:a(()=>[l(le,{label:"update_restart"},{default:a(()=>[...e[41]||(e[41]=[o("更新并重启Webman",-1)])]),_:1}),l(le,{label:"update_only"},{default:a(()=>[...e[42]||(e[42]=[o("只更新无需重启",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"目标服务器"},{default:a(()=>[l(q,{modelValue:p.serverIds,"onUpdate:modelValue":e[19]||(e[19]=t=>p.serverIds=t),multiple:"",placeholder:"选择要部署的服务器",style:{width:"100%"}},{default:a(()=>[(D(!0),J(il,null,dl(O.value,t=>(D(),Q($,{key:t.id,label:`${t.server_name} (${t.server_ip})`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"部署说明"},{default:a(()=>[l(U,{modelValue:p.description,"onUpdate:modelValue":e[20]||(e[20]=t=>p.description=t),type:"textarea",rows:3,placeholder:"请输入部署说明..."},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"])])}}},Ql=Pe(Nl,[["__scopeId","data-v-e95dc2c5"]]);export{Ql as default};
//# sourceMappingURL=server-DQxVda8s.js.map
