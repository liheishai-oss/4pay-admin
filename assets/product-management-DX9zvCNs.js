import{d as U,h as _,ah as D,M as g,w as l,x as o,N as I,o as v,c as L,k as S,e as r,a as i,a5 as T,Y as P,C as w,A as R,K as $,L as j,S as z,as as A,j as F,v as K,g as Y}from"./index-Gdxi0XPM.js";/* empty css                *//* empty css                     *//* empty css                 *//* empty css              *//* empty css                     *//* empty css            *//* empty css             */import{b as q}from"./merchant-V1NwBl97.js";import{a as G,u as H}from"./product-B-cpjCVQ.js";const J={key:0,class:"merchant-info"},O={class:"info-row"},Q={class:"value"},W={class:"product-list"},X={class:"rate-edit"},Z={class:"dialog-footer"},ee=U({__name:"product-management",setup(ae,{expose:f}){const c=_(!1),m=_(!1),s=_(null),d=_([]),b=e=>{s.value=e,c.value=!0,C()},C=async()=>{var e;if((e=s.value)!=null&&e.id)try{m.value=!0,console.log("查询商户产品，商户ID:",s.value.id);const a=await q(s.value.id);a.code===200?d.value=a.data.products.map(t=>({...t,merchant_rate_percent:(t.merchant_rate/100).toFixed(2)})):(o.error(a.message||"获取产品列表失败"),d.value=[])}catch(a){console.error("获取产品列表失败:",a),o.error("获取产品列表失败"),d.value=[]}finally{m.value=!1}},p=()=>{c.value=!1,s.value=null,d.value=[]},V=async e=>{var a;if((a=s.value)!=null&&a.id)try{const t=await G({product_id:e.id,merchant_id:s.value.id,merchant_rate:Math.round(e.merchant_rate_percent*100),status:e.is_assigned?1:0});t.code===200?o.success(e.is_assigned?"分配成功":"取消分配成功"):(e.is_assigned=!e.is_assigned,o.error(t.message||"操作失败"))}catch(t){e.is_assigned=!e.is_assigned,console.error("状态变更失败:",t),o.error("操作失败")}},x=async e=>{var a;if(!(!((a=s.value)!=null&&a.id)||!e.is_assigned))try{const t=await H({product_id:e.id,merchant_id:s.value.id,merchant_rate:Math.round(e.merchant_rate_percent*100)});t.code===200?o.success("费率更新成功"):o.error(t.message||"费率更新失败")}catch(t){console.error("费率更新失败:",t),o.error("费率更新失败")}};return D(c,e=>{e||p()}),f({open:b}),(e,a)=>{const t=T,h=$,y=j,E=z,M=R,k=F,N=I,B=A;return v(),g(N,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=n=>c.value=n),title:"产品管理",width:"800px","close-on-click-modal":!1,onClose:p},{footer:l(()=>[r("div",Z,[i(k,{onClick:p},{default:l(()=>[...a[3]||(a[3]=[K("关闭",-1)])]),_:1})])]),default:l(()=>[s.value?(v(),L("div",J,[i(t,{shadow:"never",class:"info-card"},{default:l(()=>[r("div",O,[a[1]||(a[1]=r("span",{class:"label"},"商户名称：",-1)),r("span",Q,P(s.value.merchant_name),1)])]),_:1})])):S("",!0),r("div",W,[w((v(),g(M,{data:d.value,border:"",stripe:"","max-height":"500","empty-text":"暂无分配的产品"},{default:l(()=>[i(h,{prop:"product_name",label:"产品名称",align:"center","min-width":"200"}),i(h,{label:"状态",align:"center","min-width":"100"},{default:l(({row:n})=>[i(y,{modelValue:n.is_assigned,"onUpdate:modelValue":u=>n.is_assigned=u,"active-value":!0,"inactive-value":!1,onChange:u=>V(n)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),i(h,{label:"商户费率",align:"center","min-width":"150"},{default:l(({row:n})=>[r("div",X,[i(E,{modelValue:n.merchant_rate_percent,"onUpdate:modelValue":u=>n.merchant_rate_percent=u,min:0,max:100,precision:2,step:.01,size:"small",onChange:u=>x(n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),a[2]||(a[2]=r("span",{class:"rate-unit"},"%",-1))])]),_:1})]),_:1},8,["data"])),[[B,m.value]])])]),_:1},8,["modelValue"])}}}),_e=Y(ee,[["__scopeId","data-v-2f5214ab"]]);export{_e as default};
//# sourceMappingURL=product-management-DX9zvCNs.js.map
