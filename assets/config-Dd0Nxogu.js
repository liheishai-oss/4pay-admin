import{s as w,d as z,g,h as G,L as J,c as m,e as l,i as y,j as B,a as o,w as t,M as S,as as V,D as n,q as Q,F as H,o as c,n as v,k as W,u as h,aO as X,S as Y,aQ as I,x as Z,y as K,b8 as ee,b9 as se,t as j,a1 as oe,aS as N,_ as te}from"./index-Dwi2X-zo.js";/* empty css              */const ae=()=>w({url:"/api/v1/admin/system/config/list",method:"get"}),ne=d=>w({url:"/api/v1/admin/system/config/save",method:"post",data:d}),F=d=>w({url:"/api/v1/admin/system/config/reset",method:"post",data:d}),re={class:"system-config-page"},le={class:"action-bar"},ce={class:"card-header"},ie={class:"group-title"},ue={class:"group-actions"},fe={class:"config-item"},de={key:0,class:"config-meta"},pe={class:"default-value"},_e=z({__name:"config",setup(d){const x={device_config:"设备配置",auth_config:"后台登录认证配置",payment_config:"支付配置",notification_config:"通知配置",system_config:"系统配置"},k=g([]),i=G({}),C=g(!1),b=g(!1),u=g(null),L=s=>{switch(s){case"bool":return"el-switch";case"json":case"string":return"el-input";case"int":return"el-input-number";default:return"el-input"}},M=s=>s.config_type==="json"?{type:"textarea",rows:3,placeholder:"JSON 格式",style:"font-family: monospace;"}:s.config_type==="int"?{min:0,precision:0}:s.config_type==="string"?{placeholder:"请输入配置值"}:{},p=async()=>{C.value=!0;try{const s=await ae();s.code===200?(k.value=s.data||[],Object.keys(i).forEach(e=>{delete i[e]}),k.value.forEach(e=>{i[e.group_key]||(i[e.group_key]=[]),i[e.group_key].push(e)}),u.value=null):n.error("获取配置失败: "+s.message)}catch(s){n.error("获取配置失败"),console.error("获取配置失败:",s)}finally{C.value=!1}},O=async()=>{b.value=!0;try{const s={configs:k.value.map(r=>({id:r.id,config_value:r.config_value}))},e=await ne(s);e.code===200?(n.success(e.message||"配置保存成功"),u.value={message:e.message||"配置保存成功",type:"success"}):(n.error("保存失败: "+e.message),u.value={message:"保存失败: "+e.message,type:"error"})}catch(s){n.error("保存失败"),u.value={message:"保存失败",type:"error"},console.error("保存配置失败:",s)}finally{b.value=!1}},$=()=>{p()},D=async s=>{try{await N.confirm(`确定要重置 "${x[s]||s}" 分组的所有配置吗？`,"确认重置",{type:"warning"});const e=await F({group_key:s});e.code===200?(n.success(e.message||"分组重置成功"),p()):n.error("重置失败: "+e.message)}catch(e){e!=="cancel"&&(n.error("重置失败"),console.error("重置配置失败:",e))}},T=async()=>{try{await N.confirm("确定要重置所有配置到默认值吗？此操作不可撤销！","确认重置所有配置",{type:"warning",confirmButtonText:"确定重置",cancelButtonText:"取消"});const s=Object.keys(i);let e=0;for(const r of s)try{(await F({group_key:r})).code===200&&e++}catch(f){console.error(`重置分组 ${r} 失败:`,f)}e>0?(n.success(`成功重置 ${e} 个分组`),p()):n.error("重置失败")}catch(s){s!=="cancel"&&(n.error("重置失败"),console.error("重置所有配置失败:",s))}};return J(()=>{p()}),(s,e)=>{const r=W,f=Q,A=K,P=Z,R=oe,U=H;return c(),m("div",re,[e[4]||(e[4]=l("div",{class:"page-header"},[l("h1",null,"系统配置"),l("p",null,"管理系统各项配置参数")],-1)),l("div",le,[o(f,{type:"primary",onClick:O,loading:b.value},{default:t(()=>[o(r,null,{default:t(()=>[o(h(X))]),_:1}),e[0]||(e[0]=v(" 保存配置 ",-1))]),_:1},8,["loading"]),o(f,{onClick:$,loading:C.value},{default:t(()=>[o(r,null,{default:t(()=>[o(h(Y))]),_:1}),e[1]||(e[1]=v(" 刷新 ",-1))]),_:1},8,["loading"]),o(f,{type:"warning",onClick:T},{default:t(()=>[o(r,null,{default:t(()=>[o(h(I))]),_:1}),e[2]||(e[2]=v(" 重置所有配置 ",-1))]),_:1})]),(c(!0),m(S,null,V(i,(E,_)=>(c(),y(R,{key:_,class:"config-group-card"},{header:t(()=>[l("div",ce,[l("span",ie,j(x[_]||_),1),l("div",ue,[o(f,{size:"small",onClick:a=>D(_)},{default:t(()=>[o(r,null,{default:t(()=>[o(h(I))]),_:1}),e[3]||(e[3]=v(" 重置此组 ",-1))]),_:1},8,["onClick"])])])]),default:t(()=>[o(P,{model:E,"label-width":"180px",class:"config-form"},{default:t(()=>[(c(!0),m(S,null,V(E,a=>(c(),y(A,{key:a.config_key,label:a.description||a.config_key,help:a.help_text},{default:t(()=>[l("div",fe,[(c(),y(ee(L(a.config_type)),se({modelValue:a.config_value,"onUpdate:modelValue":q=>a.config_value=q},{ref_for:!0},M(a),{class:"config-input"}),null,16,["modelValue","onUpdate:modelValue"])),a.default_value?(c(),m("div",de,[l("span",pe,"默认值: "+j(a.default_value),1)])):B("",!0)])]),_:2},1032,["label","help"]))),128))]),_:2},1032,["model"])]),_:2},1024))),128)),u.value?(c(),y(U,{key:0,title:u.value.message,type:u.value.type,closable:!1,class:"save-alert"},null,8,["title","type"])):B("",!0)])}}}),ye=te(_e,[["__scopeId","data-v-e7eb3322"]]);export{ye as default};
//# sourceMappingURL=config-Dd0Nxogu.js.map
