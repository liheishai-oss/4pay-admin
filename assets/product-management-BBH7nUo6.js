import{d as N,g as _,aj as U,i as g,w as l,D as o,C as I,o as v,c as T,j as L,e as r,a as i,a1 as P,t as S,Q as j,O as w,W as R,X as $,a3 as q,au as z,q as F,n as O,_ as Q}from"./index-BwnaPa-Z.js";/* empty css                *//* empty css                     *//* empty css                 *//* empty css                     */import{b as W}from"./merchant-CRLv-zfn.js";import{a as X,u as A}from"./product-j4NY42Y_.js";const G={key:0,class:"merchant-info"},H={class:"info-row"},J={class:"value"},K={class:"product-list"},Y={class:"rate-edit"},Z={class:"dialog-footer"},ee=N({__name:"product-management",setup(ae,{expose:f}){const c=_(!1),m=_(!1),s=_(null),d=_([]),b=e=>{s.value=e,c.value=!0,C()},C=async()=>{var e;if((e=s.value)!=null&&e.id)try{m.value=!0,console.log("查询商户产品，商户ID:",s.value.id);const a=await W(s.value.id);a.code===200?d.value=a.data.products.map(t=>({...t,merchant_rate_percent:(t.merchant_rate/100).toFixed(2)})):(o.error(a.message||"获取产品列表失败"),d.value=[])}catch(a){console.error("获取产品列表失败:",a),o.error("获取产品列表失败"),d.value=[]}finally{m.value=!1}},p=()=>{c.value=!1,s.value=null,d.value=[]},V=async e=>{var a;if((a=s.value)!=null&&a.id)try{const t=await X({product_id:e.id,merchant_id:s.value.id,merchant_rate:Math.round(e.merchant_rate_percent*100),status:e.is_assigned?1:0});t.code===200?o.success(e.is_assigned?"分配成功":"取消分配成功"):(e.is_assigned=!e.is_assigned,o.error(t.message||"操作失败"))}catch(t){e.is_assigned=!e.is_assigned,console.error("状态变更失败:",t),o.error("操作失败")}},x=async e=>{var a;if(!(!((a=s.value)!=null&&a.id)||!e.is_assigned))try{const t=await A({product_id:e.id,merchant_id:s.value.id,merchant_rate:Math.round(e.merchant_rate_percent*100)});t.code===200?o.success("费率更新成功"):o.error(t.message||"费率更新失败")}catch(t){console.error("费率更新失败:",t),o.error("费率更新失败")}};return U(c,e=>{e||p()}),f({open:b}),(e,a)=>{const t=P,h=R,y=$,E=q,M=w,k=F,B=I,D=z;return v(),g(B,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=n=>c.value=n),title:"产品管理",width:"800px","close-on-click-modal":!1,onClose:p},{footer:l(()=>[r("div",Z,[i(k,{onClick:p},{default:l(()=>[...a[3]||(a[3]=[O("关闭",-1)])]),_:1})])]),default:l(()=>[s.value?(v(),T("div",G,[i(t,{shadow:"never",class:"info-card"},{default:l(()=>[r("div",H,[a[1]||(a[1]=r("span",{class:"label"},"商户名称：",-1)),r("span",J,S(s.value.merchant_name),1)])]),_:1})])):L("",!0),r("div",K,[j((v(),g(M,{data:d.value,border:"",stripe:"","max-height":"500","empty-text":"暂无分配的产品"},{default:l(()=>[i(h,{prop:"product_name",label:"产品名称",align:"center","min-width":"200"}),i(h,{label:"状态",align:"center","min-width":"100"},{default:l(({row:n})=>[i(y,{modelValue:n.is_assigned,"onUpdate:modelValue":u=>n.is_assigned=u,"active-value":!0,"inactive-value":!1,onChange:u=>V(n)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),i(h,{label:"商户费率",align:"center","min-width":"150"},{default:l(({row:n})=>[r("div",Y,[i(E,{modelValue:n.merchant_rate_percent,"onUpdate:modelValue":u=>n.merchant_rate_percent=u,min:0,max:100,precision:2,step:.01,size:"small",onChange:u=>x(n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),a[2]||(a[2]=r("span",{class:"rate-unit"},"%",-1))])]),_:1})]),_:1},8,["data"])),[[D,m.value]])])]),_:1},8,["modelValue"])}}}),ce=Q(ee,[["__scopeId","data-v-2f5214ab"]]);export{ce as default};
//# sourceMappingURL=product-management-BBH7nUo6.js.map
