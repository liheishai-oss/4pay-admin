const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/detail-DD4X2EP7.js","assets/index-DSzZq5R0.js","assets/index-qjTWfGgT.css","assets/orderManagement-mutiWfAJ.js","assets/detail-CoVh6DoR.css","assets/loading-oV0W9nDj.css","assets/empty-iVBaPuAw.css","assets/table-column-DHEyVPoW.css","assets/checkbox-CXazyT-T.css"])))=>i.map(i=>d[i]);
import{d as Be,g as E,L as $e,c as M,a,e as r,u as i,w as n,T as ze,Q as y,i as v,n as d,t as m,M as K,s as k,q as Ie,N as Fe,O as Ae,P as Le,aG as Ne,o as _,av as Oe,a1 as Ue,x as Ye,E as He,b as je,y as Ge,z as Qe,ar as Je,as as We,at as Xe,aH as Ze,k as Ke,V as P,S as ee,R as Pe,W as et,a8 as tt,aX as at,aY as nt,aZ as ot,j as L,a_ as st,aw as te,C as u,aS as V,$ as lt,_ as rt}from"./index-DSzZq5R0.js";/* empty css                   *//* empty css               *//* empty css                     *//* empty css                 *//* empty css                          */import{u as it}from"./table.plugin-C_WHYkfe.js";const dt={class:"table-com-search"},ut={key:1,style:{color:"#999","font-size":"12px"}},ct={class:"search-buttons"},_t={class:"table-header ba-scroll-style"},mt={class:"table-statistics"},pt={class:"stat-item stat-highlight"},ft={class:"stat-number"},gt={class:"stat-item stat-highlight"},ht={class:"stat-number"},yt={class:"stat-item stat-success"},vt={class:"stat-number"},bt={class:"stat-item stat-success"},wt={class:"stat-number"},kt={class:"stat-item stat-warning"},xt={class:"stat-number"},Ct={class:"stat-item stat-warning"},Tt={class:"stat-number"},Rt={class:"stat-item stat-success"},St={class:"stat-number"},Et={class:"table-search"},Vt={style:{width:"100%","overflow-x":"auto"},class:"table-content"},qt={key:0},Dt={key:1},Mt={class:"table-footer"},Bt={class:"table-pagination"},$t=Be({__name:"home",setup(zt){const ae=Oe(()=>te(()=>import("./detail-DD4X2EP7.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),B=E(null),ne=(t={})=>{console.log(t),lt(()=>{B.value&&B.value.open?B.value.open({...t}):console.error("DetailForm 组件未正确挂载！")})},{handleSelectionChange:oe,hasSelectedRows:$,isVisible:N,toggleVisibility:se,loadData:le,data:g,refreshData:h,handleSizeChange:re,handleCurrentChange:ie,searchParams:R}=it("/api/v1/admin/order");N.value=!0,R.value.search||(R.value.search={});const de=()=>{R.value.search||(R.value.search={order_no:"",merchant_order_no:"",merchant_id:"",status:"",start_time:"",end_time:""})},c=E({order_no:"",merchant_order_no:"",merchant_id:"",status:"",timeRange:null}),q=E([]),S=E(null),z=E(!1),p=E(null),I=t=>t?Number(t).toFixed(2):"0.00",ue=t=>t?Number(t).toFixed(2):"0.00",ce=async()=>{try{const t=await k.get("/api/v1/admin/user/info");console.log("用户信息API响应:",t),t.code===200&&(S.value=t.data,console.log("用户信息:",S.value),console.log("是否为商户管理员:",S.value.is_merchant_admin))}catch(t){console.error("获取用户信息失败:",t)}},_e=async()=>{try{const t=await k.get("/api/v1/admin/merchant",{params:{page:1,page_size:1e3,search:JSON.stringify({})}});console.log("商户API响应:",t),t.code===200?(q.value=t.data.data||[],console.log("商户列表:",q.value)):console.log("商户API响应错误:",t)}catch(t){console.error("获取商户列表失败:",t),q.value=[]}},F=async(t={})=>{try{const e={};t&&Object.keys(t).length>0&&(t.timeRange&&t.timeRange.length===2&&(e.start_time=t.timeRange[0],e.end_time=t.timeRange[1]),t.order_no&&(e.order_no=t.order_no),t.merchant_order_no&&(e.merchant_order_no=t.merchant_order_no),t.merchant_id&&(e.merchant_id=t.merchant_id),t.status&&(e.status=t.status),t.start_time&&(e.start_time=t.start_time),t.end_time&&(e.end_time=t.end_time)),console.log("统计接口请求参数:",e);const o=await k.get("/api/v1/admin/order/statistics",{params:e});o.code===200&&(p.value=o.data,console.log("统计数据更新:",p.value))}catch(e){console.error("获取统计数据失败:",e),p.value={total_orders:0,total_amount:0,paid_orders:0,paid_amount:0,merchant_income:0,unpaid_orders:0,unpaid_amount:0,success_rate:0}}},me=async()=>{z.value=!0;try{let t={...c.value};t.timeRange&&t.timeRange.length===2&&(t.start_time=t.timeRange[0],t.end_time=t.timeRange[1]),delete t.timeRange,delete t.quickTime,R.value.search=t,await h(),await F(t)}catch(t){console.error("搜索失败:",t),u.error("搜索失败，请重试")}finally{z.value=!1}},pe=async()=>{c.value={order_no:"",merchant_order_no:"",merchant_id:"",status:"",timeRange:null},R.value.search={...c.value},await h(),await F()};$e(()=>{var t;de(),le(),F(),ce(),_e(),console.log("data.admin:",g.value.admin),console.log("userInfo:",S.value),console.log("merchantList:",q.value),console.log("isMerchantAdmin:",(t=S.value)==null?void 0:t.is_merchant_admin)});const O=t=>({1:"待支付",2:"支付中",3:"支付成功",4:"支付失败",5:"已退款",6:"已关闭"})[t]||"未知状态",fe=t=>({1:"warning",2:"primary",3:"success",4:"danger",5:"info",6:"info"})[t]||"info",ge=t=>({0:"未通知",1:"通知成功",2:"通知失败"})[t]||"未知状态",he=t=>({0:"warning",1:"success",2:"danger"})[t]||"info",ye=async t=>{try{await V.confirm(`确定要退款订单 ${t.order_no} 吗？`,"确认退款",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const{refundOrder:e}=await te(async()=>{const{refundOrder:s}=await import("./orderManagement-mutiWfAJ.js");return{refundOrder:s}},__vite__mapDeps([3,1,2])),o=await e("/api/v1/admin/order/refund",{order_id:t.id,reason:"管理员退款"});o.status?(u.success("退款申请已提交"),h()):u.error(o.message)}catch(e){e!=="cancel"&&u.error("退款申请失败")}},ve=async t=>{try{await V.confirm(`确定要补单 ${t.order_no} 吗？`,"确认补单",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await k.post("/api/v1/admin/order/reissue",{ids:[t.id]});e.code===200?(u.success("补单成功"),h()):u.error(e.msg)}catch{u.error("补单失败")}},be=async t=>{try{await V.confirm(`确定要重新回调 ${t.order_no} 吗？`,"确认回调",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await k.post("/api/v1/admin/order/callback",{ids:[t.id]});e.code===200?(u.success("回调成功"),h()):u.error(e.msg)}catch{u.error("回调失败")}},we=async()=>{var t;if(!$.value){u.warning("请选择要补单的订单");return}try{await V.confirm("确定要批量补单选中的订单吗？","确认批量补单",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await k.post("/api/v1/admin/order/reissue",{ids:((t=g.value.selectedRows)==null?void 0:t.map(o=>o.id))||[]});e.code===200?(u.success("批量补单成功"),h()):u.error(e.msg)}catch{u.error("批量补单失败")}},ke=async()=>{var t;if(!$.value){u.warning("请选择要回调的订单");return}try{await V.confirm("确定要批量回调选中的订单吗？","确认批量回调",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await k.post("/api/v1/admin/order/callback",{ids:((t=g.value.selectedRows)==null?void 0:t.map(o=>o.id))||[]});e.code===200?(u.success("批量回调成功"),h()):u.error(e.msg)}catch{u.error("批量回调失败")}},xe=(t,e)=>{switch(t){case"detail":ne(e);break;case"query":Ce(e);break;case"refund":ye(e);break;case"resend":ve(e);break;case"callback":be(e);break;default:console.warn("未知操作:",t)}},Ce=async t=>{try{const e=await k.post("/api/v1/admin/order/query",{order_no:t.order_no});if(e.code===200){const o=e.data;let s=`📋 订单信息
`;s+=`═══════════════════════════════════════════════════════════
`,s+=`🔢 订单号：${o.order_no}
`,s+=`📊 当前状态：${O(o.status)}
`,s+=`💰 订单金额：¥${(o.amount/100).toFixed(2)}
`,s+=`📅 创建时间：${new Date(o.created_at).toLocaleString()}

`,s+=`🔍 支付通道查询结果
`,s+=`───────────────────────────────────────────────────────────
`,o.query_success?(s+=`✅ 查询状态：成功
`,o.query_result&&o.query_result.unified_status_text?s+=`📊 当前状态：${o.query_result.unified_status_text}
`:s+=`📊 当前状态：${o.query_message}
`,o.query_result&&o.query_result.unified_status_text&&(s+=`
📋 状态详情：
`,s+=`───────────────────────────────────────────────────────────
`,s+=`🎯 统一状态：${o.query_result.unified_status_text}
`,s+=`📝 原始状态：${o.query_result.original_status||"未知"}
`,s+=`📊 状态字段：${o.query_result.original_status_field||"status"}
`,s+=`🏢 供货商类型：${o.query_result.supplier_type||"未知"}
`),o.query_result&&Object.keys(o.query_result).length>0||(s+=`
📄 通道返回数据：无数据
`)):(s+=`❌ 查询状态：失败
`,s+=`⚠️  错误信息：${o.query_message}
`),s+=`
═══════════════════════════════════════════════════════════`;const b=s.replace(/\n/g,"<br>").replace(/`([^`]+)`/g,"<code>$1</code>");V.alert(b,"🔍 查单结果",{confirmButtonText:"确定",type:o.query_success?"success":"warning",dangerouslyUseHTMLString:!0,customStyle:{"max-width":"900px","max-height":"700px",overflow:"auto","font-family":"monospace","line-height":"1.6","white-space":"pre-wrap","word-break":"break-all"}})}else console.error("查单API返回错误：",e),u.error(e.msg||"查单失败")}catch(e){console.error("查单请求异常：",e),u.error("查单失败："+(e.message||"网络错误"))}};return(t,e)=>{var j,G,Q,J,W,X,Z;const o=Qe,s=Ge,b=je,x=Xe,U=Je,Y=He,Te=Ze,A=Ke,C=Ie,Re=Ye,Se=Ue,Ee=Fe,f=et,H=tt,D=st,Ve=ot,qe=at,De=Ae,Me=Le,w=Ne("permission");return _(),M(K,null,[a(i(ae),{ref_key:"detailFormRef",ref:B,onRefresh:i(h)},null,8,["onRefresh"]),a(ze,{name:"fade"},{default:n(()=>[y(r("div",dt,[a(Se,{class:"search-card",shadow:"never"},{default:n(()=>[a(Re,{model:c.value,"label-width":"100px",class:"search-form"},{default:n(()=>[a(Y,{gutter:20},{default:n(()=>[a(b,{span:6},{default:n(()=>[a(s,{label:"订单号"},{default:n(()=>[a(o,{modelValue:c.value.order_no,"onUpdate:modelValue":e[0]||(e[0]=l=>c.value.order_no=l),placeholder:"请输入订单号",clearable:"","prefix-icon":"Search"},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{span:6},{default:n(()=>[a(s,{label:"商户订单号"},{default:n(()=>[a(o,{modelValue:c.value.merchant_order_no,"onUpdate:modelValue":e[1]||(e[1]=l=>c.value.merchant_order_no=l),placeholder:"请输入商户订单号",clearable:"","prefix-icon":"Search"},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{span:6},{default:n(()=>[a(s,{label:"商户"},{default:n(()=>{var l;return[(l=S.value)!=null&&l.is_merchant_admin?(_(),M("div",ut," 商户用户无需选择商户 ")):(_(),v(U,{key:0,modelValue:c.value.merchant_id,"onUpdate:modelValue":e[2]||(e[2]=T=>c.value.merchant_id=T),placeholder:"请选择商户",clearable:"",filterable:"",style:{width:"100%"}},{default:n(()=>[(_(!0),M(K,null,We(q.value,T=>(_(),v(x,{key:T.id,label:T.merchant_name,value:T.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]}),_:1})]),_:1}),a(b,{span:6},{default:n(()=>[a(s,{label:"订单状态"},{default:n(()=>[a(U,{modelValue:c.value.status,"onUpdate:modelValue":e[3]||(e[3]=l=>c.value.status=l),placeholder:"请选择订单状态",clearable:"",style:{width:"100%"}},{default:n(()=>[a(x,{label:"待支付",value:1}),a(x,{label:"支付中",value:2}),a(x,{label:"支付成功",value:3}),a(x,{label:"支付失败",value:4}),a(x,{label:"已退款",value:5}),a(x,{label:"已关闭",value:6})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(Y,{gutter:20},{default:n(()=>[a(b,{span:6},{default:n(()=>[a(s,{label:"时间范围"},{default:n(()=>[a(Te,{modelValue:c.value.timeRange,"onUpdate:modelValue":e[4]||(e[4]=l=>c.value.timeRange=l),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{span:6},{default:n(()=>[a(s,null,{default:n(()=>[r("div",ct,[a(C,{type:"primary",onClick:me,loading:z.value},{default:n(()=>[a(A,null,{default:n(()=>[a(i(P))]),_:1}),e[7]||(e[7]=d(" 搜索 ",-1))]),_:1},8,["loading"]),a(C,{onClick:pe},{default:n(()=>[a(A,null,{default:n(()=>[a(i(ee))]),_:1}),e[8]||(e[8]=d(" 重置 ",-1))]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[Pe,i(N)]])]),_:1}),r("div",_t,[y(a(C,{icon:i(ee),onClick:i(h),color:"#40485b"},null,8,["icon","onClick"]),[[w,"order:list"]]),y((_(),v(C,{type:"primary",disabled:!i($),onClick:we},{default:n(()=>[...e[9]||(e[9]=[d("补单",-1)])]),_:1},8,["disabled"])),[[w,"order:resend"]]),y((_(),v(C,{type:"primary",disabled:!i($),onClick:ke},{default:n(()=>[...e[10]||(e[10]=[d("回调",-1)])]),_:1},8,["disabled"])),[[w,"order:callback"]]),r("div",mt,[r("span",pt,[e[11]||(e[11]=d("累计订单数: ",-1)),r("b",ft,m(((j=p.value)==null?void 0:j.total_orders)||0),1)]),r("span",gt,[e[12]||(e[12]=d("订单总金额: ",-1)),r("b",ht,"¥"+m(I(((G=p.value)==null?void 0:G.total_amount)||0)),1)]),r("span",yt,[e[13]||(e[13]=d("已付订单数: ",-1)),r("b",vt,m(((Q=p.value)==null?void 0:Q.paid_orders)||0),1)]),r("span",bt,[e[14]||(e[14]=d("已付总金额: ",-1)),r("b",wt,"¥"+m(I(((J=p.value)==null?void 0:J.paid_amount)||0)),1)]),r("span",kt,[e[15]||(e[15]=d("未付订单数: ",-1)),r("b",xt,m(((W=p.value)==null?void 0:W.unpaid_orders)||0),1)]),r("span",Ct,[e[16]||(e[16]=d("未付总金额: ",-1)),r("b",Tt,"¥"+m(I(((X=p.value)==null?void 0:X.unpaid_amount)||0)),1)]),r("span",Rt,[e[17]||(e[17]=d("成功率: ",-1)),r("b",St,m(ue(((Z=p.value)==null?void 0:Z.success_rate)||0))+"%",1)])]),r("div",Et,[a(Ee,{class:"ml-4"},{default:n(()=>[a(C,{icon:i(P),onClick:i(se)},null,8,["icon","onClick"])]),_:1})])]),r("div",Vt,[a(De,{data:i(g).data,border:"",stripe:"","max-height":"600",style:{width:"100%"},onSelectionChange:i(oe)},{default:n(()=>[a(f,{type:"selection",width:"40"}),a(f,{prop:"order_no",label:"平台单号",align:"center","min-width":"200"}),a(f,{prop:"merchant_order_no",label:"商户单号",align:"center","min-width":"167"}),a(f,{prop:"amount",label:"订单金额",align:"center","min-width":"100"},{default:n(({row:l})=>[d(" ¥"+m((l.amount/100).toFixed(2)),1)]),_:1}),a(f,{label:"支付状态",align:"center","min-width":"100"},{default:n(({row:l})=>[a(H,{type:fe(l.status)},{default:n(()=>[d(m(O(l.status)),1)]),_:2},1032,["type"])]),_:1}),a(f,{prop:"notify_status",label:"回调状态",align:"center","min-width":"100"},{default:n(({row:l})=>[a(H,{type:he(l.notify_status),size:"small"},{default:n(()=>[d(m(ge(l.notify_status)),1)]),_:2},1032,["type"])]),_:1}),a(f,{prop:"merchant.merchant_name",label:"商户名称",align:"center","min-width":"150"}),a(f,{label:"通道名称",align:"center","min-width":"120"},{default:n(({row:l})=>[l.channel?(_(),M("span",qt,m(l.channel.channel_name||"百亿支付"),1)):(_(),M("span",Dt," 百亿支付 "))]),_:1}),a(f,{prop:"paid_time",label:"支付时间",align:"center","min-width":"160"}),a(f,{label:"操作",align:"center",fixed:"right","min-width":"120"},{default:n(l=>[a(qe,{trigger:"click",onCommand:T=>xe(T,l.row)},{dropdown:n(()=>[a(Ve,null,{default:n(()=>[y((_(),v(D,{command:"detail"},{default:n(()=>[...e[19]||(e[19]=[d("订单详情",-1)])]),_:1})),[[w,"order:detail"]]),y((_(),v(D,{command:"query"},{default:n(()=>[...e[20]||(e[20]=[d("查单",-1)])]),_:1})),[[w,"order:query"]]),l.row.status===3?y((_(),v(D,{key:0,command:"refund"},{default:n(()=>[...e[21]||(e[21]=[d("退款",-1)])]),_:1})),[[w,"order:refund"]]):L("",!0),[4,6].includes(l.row.status)?y((_(),v(D,{key:1,command:"resend"},{default:n(()=>[...e[22]||(e[22]=[d("补单",-1)])]),_:1})),[[w,"order:resend"]]):L("",!0),l.row.status===3?y((_(),v(D,{key:2,command:"callback"},{default:n(()=>[...e[23]||(e[23]=[d("回调",-1)])]),_:1})),[[w,"order:callback"]]):L("",!0)]),_:2},1024)]),default:n(()=>[a(C,{size:"small",type:"primary"},{default:n(()=>[e[18]||(e[18]=d(" 操作",-1)),a(A,{class:"el-icon--right"},{default:n(()=>[a(i(nt))]),_:1})]),_:1})]),_:2},1032,["onCommand"])]),_:1})]),_:1},8,["data","onSelectionChange"])]),r("div",Mt,[r("div",Bt,[a(Me,{"current-page":i(g).current_page,"onUpdate:currentPage":e[5]||(e[5]=l=>i(g).current_page=l),"page-size":i(g).page_size,"onUpdate:pageSize":e[6]||(e[6]=l=>i(g).page_size=l),"page-sizes":[10,50,100,200],background:!0,"prev-text":"上一页","next-text":"下一页",layout:"total, sizes, prev, pager, next, jumper",total:i(g).page_total,onSizeChange:i(re),onCurrentChange:i(ie)},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])],64)}}}),Yt=rt($t,[["__scopeId","data-v-c9eb8073"]]);export{Yt as default};
//# sourceMappingURL=home-Ydy9NPnh.js.map
