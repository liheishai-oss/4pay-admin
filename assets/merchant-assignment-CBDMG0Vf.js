import{d as L,g as u,i as f,w as o,D as l,C as T,o as p,e as s,c as A,j as P,a as r,a1 as S,t as h,n as g,Q as R,O as $,W as j,X as q,a3 as z,au as F,q as O,_ as Q}from"./index-Dwi2X-zo.js";/* empty css                *//* empty css                     *//* empty css                 *//* empty css                     */import{c as W,a as b,u as X}from"./product-aoAQyEbo.js";const G={class:"merchant-assignment"},H={key:0,class:"product-info"},J={class:"product-header"},K={class:"product-details"},Y={class:"detail-item"},Z={class:"detail-item"},w={class:"merchant-list"},ee={class:"rate-edit"},ae={class:"dialog-footer"},te=L({__name:"merchant-assignment",setup(se,{expose:V}){const c=u(!1),_=u(!1),t=u(null),d=u([]),C=a=>{t.value=a,c.value=!0,x()},x=async()=>{if(t.value){_.value=!0;try{console.log("正在获取商户列表，产品ID:",t.value.id);const a=await W(t.value.id);console.log("API响应:",a),a.status?(console.log("商户数据:",a.data.merchants),d.value=a.data.merchants.map(e=>({...e,merchant_rate:e.merchant_rate||e.default_rate_bp,merchant_rate_percent:(e.merchant_rate||e.default_rate_bp)/100,is_assigned:e.is_assigned||!1})),console.log("处理后的商户列表:",d.value)):(console.error("API返回错误:",a.message),l.error(a.message||"获取商户列表失败"))}catch(a){console.error("获取商户列表失败:",a),l.error("获取商户列表失败")}finally{_.value=!1}}},y=async a=>{if(t.value)try{if(a.is_assigned){const e=await b({product_id:t.value.id,merchant_id:a.id,merchant_rate:a.merchant_rate});e.status?l.success("分配成功"):(l.error(e.message||"分配失败"),a.is_assigned=!1)}else{const e=await X({product_id:t.value.id,merchant_id:a.id,merchant_rate:0});e.status?l.success("已取消分配"):(l.error(e.message||"取消分配失败"),a.is_assigned=!0)}}catch(e){console.error("状态更新失败:",e),l.error("操作失败"),a.is_assigned=!a.is_assigned}},E=async a=>{if(t.value){a.merchant_rate=Math.round(a.merchant_rate_percent*100),console.log("费率变化:",a.merchant_name,"百分比:",a.merchant_rate_percent,"存储值:",a.merchant_rate);try{const e=await b({product_id:t.value.id,merchant_id:a.id,merchant_rate:a.merchant_rate});e.status?l.success("费率更新成功"):l.error(e.message||"费率更新失败")}catch(e){console.error("费率更新失败:",e),l.error("费率更新失败")}}},v=()=>{c.value=!1,t.value=null,d.value=[]};return V({open:C}),(a,e)=>{const I=S,m=j,M=q,k=z,B=$,D=O,N=T,U=F;return p(),f(N,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=n=>c.value=n),title:"分配给商户",width:"80%","before-close":v,"destroy-on-close":""},{footer:o(()=>[s("div",ae,[r(D,{onClick:v},{default:o(()=>[...e[4]||(e[4]=[g("关闭",-1)])]),_:1})])]),default:o(()=>[s("div",G,[t.value?(p(),A("div",H,[r(I,{shadow:"never",class:"mb-4"},{default:o(()=>[s("div",J,[s("h3",null,h(t.value.product_name),1),s("div",K,[s("span",Y,[e[1]||(e[1]=s("strong",null,"对接编号：",-1)),g(h(t.value.external_code),1)]),s("span",Z,[e[2]||(e[2]=s("strong",null,"默认费率：",-1)),g(h((t.value.default_rate_bp/100).toFixed(2))+"% ",1)])])])]),_:1})])):P("",!0),s("div",w,[R((p(),f(B,{data:d.value,border:"",stripe:"","max-height":"500"},{default:o(()=>[r(m,{prop:"merchant_name",label:"商户名称",align:"center","min-width":"200"}),r(m,{label:"状态",align:"center","min-width":"100"},{default:o(({row:n})=>[r(M,{modelValue:n.is_assigned,"onUpdate:modelValue":i=>n.is_assigned=i,"active-value":!0,"inactive-value":!1,onChange:i=>y(n),disabled:n.status!==1},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"])]),_:1}),r(m,{label:"商户费率",align:"center","min-width":"150"},{default:o(({row:n})=>[s("div",ee,[r(k,{modelValue:n.merchant_rate_percent,"onUpdate:modelValue":i=>n.merchant_rate_percent=i,min:0,max:100,precision:2,step:.01,size:"small",onChange:i=>E(n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),e[3]||(e[3]=s("span",{class:"rate-unit"},"%",-1))])]),_:1})]),_:1},8,["data"])),[[U,_.value]])])])]),_:1},8,["modelValue"])}}}),de=Q(te,[["__scopeId","data-v-4813327d"]]);export{de as default};
//# sourceMappingURL=merchant-assignment-CBDMG0Vf.js.map
