import{d as S,h as c,ao as k,ah as q,M as L,w as r,x as v,N as U,o as _,C as Y,c as f,a as p,k as b,e as s,aX as j,a5 as z,v as m,Y as h,aY as F,aF as O,as as X,j as G,aS as H,g as J}from"./index-Gdxi0XPM.js";/* empty css                *//* empty css              *//* empty css                 *//* empty css             */import{d as K,f as Q}from"./product-B-cpjCVQ.js";const R={"element-loading-text":"加载中..."},W={key:0,class:"current-product-info mb-4"},Z={class:"product-info"},ee={class:"transfer-container"},ae={class:"product-info"},se={class:"channel-name"},le={key:0,class:"weight-badge"},te={key:0,class:"status-badge"},oe={class:"dialog-footer"},ne=S({__name:"pool",emits:["refresh"],setup(ie,{expose:P,emit:$}){const d=c(!1),y=c(!1),C=c(!1),l=c(null),o=c({assigned:[],unassigned:[]}),D=k(()=>l.value?`轮询池管理 - ${l.value.product_name}`:"轮询池管理"),V=$,B=k(()=>[...o.value.unassigned,...o.value.assigned].map(e=>({key:e.key||e.channel_id,label:e.display_name||`${e.supplier_name}-${e.channel_name}-${e.cost_rate}%`,channel_id:e.channel_id,channel_name:e.channel_name,cost_rate:e.cost_rate,weight:e.weight,min_amount:e.min_amount,max_amount:e.max_amount,interface_code:e.interface_code,supplier_name:e.supplier_name,display_name:e.display_name,status:e.status,is_enabled:e.is_enabled,disabled:!1}))),g=k({get(){return o.value.assigned.map(a=>a.key||a.channel_id)},set(a){const e=[...o.value.unassigned,...o.value.assigned],i=e.filter(n=>a.includes(n.key||n.channel_id)),u=e.filter(n=>!a.includes(n.key||n.channel_id));o.value.assigned=i,o.value.unassigned=u}}),E=(a,e,i)=>{console.log("Transfer changed:",{value:a,direction:e,movedKeys:i}),console.log("Current poolData:",o.value),console.log("Current selectedProducts:",g.value)},T=async(a=null)=>{console.log("Opening pool dialog with product:",a),l.value=a,d.value=!0,await I()},I=async()=>{var a;if(console.log("loadPoolData called, currentProduct:",l.value),!((a=l.value)!=null&&a.id)){console.log("No product ID, skipping API call");return}y.value=!0;try{const e=`/api/v1/admin/product/pool/list?product_id=${l.value.id}`;console.log("Making API request to:",e);const i=await K(e);console.log("API response:",i);const{status:u,data:n}=i;u&&n?(o.value={assigned:n.assigned_channels||[],unassigned:n.available_channels||[]},console.log("Pool data updated:",o.value)):v.error("加载轮询池数据失败")}catch(e){console.error("API request failed:",e),v.error("加载轮询池数据失败")}finally{y.value=!1}},N=async()=>{try{await H.confirm("确定要保存轮询池的更改吗？","确认保存",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),C.value=!0,await Q("/api/v1/admin/product/pool/update",{product_id:l.value.id,channel_ids:g.value}),v.success("保存成功"),V("refresh"),d.value=!1}catch(a){a!=="cancel"&&v.error("保存失败")}finally{C.value=!1}},w=()=>{d.value=!1,l.value=null};return q(d,a=>{a||(l.value=null,o.value={assigned:[],unassigned:[]})}),P({open:T}),(a,e)=>{const i=j,u=z,n=F,x=G,A=U,M=X;return _(),L(A,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=t=>d.value=t),title:D.value,width:"70%","before-close":w},{footer:r(()=>[s("div",oe,[p(x,{onClick:w},{default:r(()=>[...e[6]||(e[6]=[m("取消",-1)])]),_:1}),p(x,{type:"primary",onClick:N,loading:C.value},{default:r(()=>[...e[7]||(e[7]=[m("保存",-1)])]),_:1},8,["loading"])])]),default:r(()=>[Y((_(),f("div",R,[p(i,{type:"info",closable:!1,"show-icon":"",class:"mb-4"},{default:r(()=>[...e[2]||(e[2]=[s("div",{class:"usage-instructions"},[s("p",null,[s("strong",null,"轮询池管理说明：")]),s("ul",null,[s("li",null,"轮询池中的通道会参与轮询调度，可选通道不会参与"),s("li",null,"可以通过搜索框快速查找特定通道"),s("li",null,'操作完成后请点击"保存"按钮确认更改')])],-1)])]),_:1}),l.value?(_(),f("div",W,[p(u,null,{header:r(()=>[...e[3]||(e[3]=[s("span",null,"当前产品信息",-1)])]),default:r(()=>[s("div",Z,[s("span",null,[e[4]||(e[4]=s("strong",null,"产品名称：",-1)),m(h(l.value.product_name),1)]),s("span",null,[e[5]||(e[5]=s("strong",null,"对接编号：",-1)),m(h(l.value.external_code),1)])])]),_:1})])):b("",!0),s("div",ee,[p(n,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),data:B.value,titles:["可选通道 (供应商-通道-成本费率)","轮询池 (供应商-通道-成本费率)"],"button-texts":["移除","分配"],format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},filterable:"","filter-placeholder":"请输入产品名称",onChange:E},{default:r(({option:t})=>[s("div",{class:O(["product-item",{"disabled-channel":!t.is_enabled}])},[s("div",ae,[s("span",se,[m(h(t.display_name||`${t.supplier_name}-${t.channel_name}-${t.cost_rate}%`)+" ",1),t.weight>0?(_(),f("span",le,"权重:"+h(t.weight),1)):b("",!0)]),t.is_enabled?b("",!0):(_(),f("span",te,"未启用"))])],2)]),_:1},8,["modelValue","data"])])])),[[M,y.value]])]),_:1},8,["modelValue","title"])}}}),me=J(ne,[["__scopeId","data-v-2ae3f651"]]);export{me as default};
//# sourceMappingURL=pool-DN_uKgA0.js.map
