import{d as A,h as u,M as f,w as o,x as l,N as D,o as p,e as s,c as S,k as T,a as r,a5 as P,Y as h,v as g,C as R,A as $,K as j,L as z,S as F,as as K,j as Y,g as q}from"./index-Gdxi0XPM.js";/* empty css                *//* empty css                     *//* empty css                 *//* empty css              *//* empty css                     *//* empty css            *//* empty css             */import{c as G,a as b,u as H}from"./product-B-cpjCVQ.js";const J={class:"merchant-assignment"},O={key:0,class:"product-info"},Q={class:"product-header"},W={class:"product-details"},X={class:"detail-item"},Z={class:"detail-item"},w={class:"merchant-list"},ee={class:"rate-edit"},ae={class:"dialog-footer"},te=A({__name:"merchant-assignment",setup(se,{expose:V}){const c=u(!1),_=u(!1),t=u(null),d=u([]),C=a=>{t.value=a,c.value=!0,x()},x=async()=>{if(t.value){_.value=!0;try{console.log("正在获取商户列表，产品ID:",t.value.id);const a=await G(t.value.id);console.log("API响应:",a),a.status?(console.log("商户数据:",a.data.merchants),d.value=a.data.merchants.map(e=>({...e,merchant_rate:e.merchant_rate||e.default_rate_bp,merchant_rate_percent:(e.merchant_rate||e.default_rate_bp)/100,is_assigned:e.is_assigned||!1})),console.log("处理后的商户列表:",d.value)):(console.error("API返回错误:",a.message),l.error(a.message||"获取商户列表失败"))}catch(a){console.error("获取商户列表失败:",a),l.error("获取商户列表失败")}finally{_.value=!1}}},y=async a=>{if(t.value)try{if(a.is_assigned){const e=await b({product_id:t.value.id,merchant_id:a.id,merchant_rate:a.merchant_rate});e.status?l.success("分配成功"):(l.error(e.message||"分配失败"),a.is_assigned=!1)}else{const e=await H({product_id:t.value.id,merchant_id:a.id,merchant_rate:0});e.status?l.success("已取消分配"):(l.error(e.message||"取消分配失败"),a.is_assigned=!0)}}catch(e){console.error("状态更新失败:",e),l.error("操作失败"),a.is_assigned=!a.is_assigned}},E=async a=>{if(t.value){a.merchant_rate=Math.round(a.merchant_rate_percent*100),console.log("费率变化:",a.merchant_name,"百分比:",a.merchant_rate_percent,"存储值:",a.merchant_rate);try{const e=await b({product_id:t.value.id,merchant_id:a.id,merchant_rate:a.merchant_rate});e.status?l.success("费率更新成功"):l.error(e.message||"费率更新失败")}catch(e){console.error("费率更新失败:",e),l.error("费率更新失败")}}},v=()=>{c.value=!1,t.value=null,d.value=[]};return V({open:C}),(a,e)=>{const M=P,m=j,k=z,I=F,N=$,B=Y,L=D,U=K;return p(),f(L,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=n=>c.value=n),title:"分配给商户",width:"80%","before-close":v,"destroy-on-close":""},{footer:o(()=>[s("div",ae,[r(B,{onClick:v},{default:o(()=>[...e[4]||(e[4]=[g("关闭",-1)])]),_:1})])]),default:o(()=>[s("div",J,[t.value?(p(),S("div",O,[r(M,{shadow:"never",class:"mb-4"},{default:o(()=>[s("div",Q,[s("h3",null,h(t.value.product_name),1),s("div",W,[s("span",X,[e[1]||(e[1]=s("strong",null,"对接编号：",-1)),g(h(t.value.external_code),1)]),s("span",Z,[e[2]||(e[2]=s("strong",null,"默认费率：",-1)),g(h((t.value.default_rate_bp/100).toFixed(2))+"% ",1)])])])]),_:1})])):T("",!0),s("div",w,[R((p(),f(N,{data:d.value,border:"",stripe:"","max-height":"500"},{default:o(()=>[r(m,{prop:"merchant_name",label:"商户名称",align:"center","min-width":"200"}),r(m,{label:"状态",align:"center","min-width":"100"},{default:o(({row:n})=>[r(k,{modelValue:n.is_assigned,"onUpdate:modelValue":i=>n.is_assigned=i,"active-value":!0,"inactive-value":!1,onChange:i=>y(n),disabled:n.status!==1},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"])]),_:1}),r(m,{label:"商户费率",align:"center","min-width":"150"},{default:o(({row:n})=>[s("div",ee,[r(I,{modelValue:n.merchant_rate_percent,"onUpdate:modelValue":i=>n.merchant_rate_percent=i,min:0,max:100,precision:2,step:.01,size:"small",onChange:i=>E(n)},null,8,["modelValue","onUpdate:modelValue","onChange"]),e[3]||(e[3]=s("span",{class:"rate-unit"},"%",-1))])]),_:1})]),_:1},8,["data"])),[[U,_.value]])])])]),_:1},8,["modelValue"])}}}),me=q(te,[["__scopeId","data-v-4813327d"]]);export{me as default};
//# sourceMappingURL=merchant-assignment-O63tLzgx.js.map
